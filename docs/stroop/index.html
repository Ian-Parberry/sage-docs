<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Stroop Test Game: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="sagedoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Game.png"/></td>
  <td id="projectalign">
   <div id="projectname">The Stroop Test Game
   </div>
   <div id="projectbrief">Game Physics with a 2D Physics Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="contents">
<div class="textblock"><p><a class="anchor" id="section1"></a></p><h1>1. Introduction</h1>
<p><a class="anchor" id="fig1"></a></p><div class="image">
<img src="card.png" alt="" width="30%"/>
<div class="caption">
Fig. 1: Example of a card used in the Stroop Test.</div></div>
<p>The <em>Stroop Test</em> is used as a measure of attention in standardized psychological tests. The participant is presented with a series of words randomly chosen from "red", "green", and "blue". These words are randomly colored either red, green, or blue, which means that the colors don't necessarily match the words. The participant has to say the word, <em>not</em> the color it is drawn in. For example, the word "blue" in <a class="el" href="#fig1">Fig. 1</a> is colored green, but the participant must say "blue". This is harder than it sounds. Studies have shown that participants take longer to complete the test than they would to recognize just words and colors alone. The Stroop Test Game makes the classical Stroop Test into a game with completely gratuitous and totally unnecessary audiovisual effects including sound, particle effects, and physics (see <a class="el" href="#fig2">Fig. 2</a>).</p>
<p><a class="anchor" id="fig2"></a></p><div class="image">
<img src="bang.png" alt="" width="60%"/>
<div class="caption">
Fig. 2: Screen shot.</div></div>
<p>The remainder of this page is divided into five sections. <a class="el" href="#section2">Section 2</a> lists the controls and their corresponding actions, <a class="el" href="#section3">Section 3</a> tells you how to build it, <a class="el" href="#section4">Section 4</a> gives you a list of actions to take in the game to see some of its important features, <a class="el" href="#section5">Section 5</a> gives a breakdown of the code, and <a class="el" href="#section6">Section 6</a> addresses the question "what next?".</p>
<p><a class="anchor" id="section2"></a></p><h1>2. Keyboard Controls</h1>
<center> <table class="doxtable">
<tr>
<td><center><b>Key</b></center> </td><td><center><b>Action</b></center> </td></tr>
<tr>
<td><center>F1</center> </td><td>Help (this document) </td></tr>
<tr>
<td><center>F2</center> </td><td>Toggle draw mode from "sprites only", to "sprites and lines", to "lines only" </td></tr>
<tr>
<td><center>F3</center> </td><td>Toggle drawing of air pressure </td></tr>
<tr>
<td><center>F4</center> </td><td>Toggle drawing of wind vectors </td></tr>
<tr>
<td><center>F5</center> </td><td>Toggle drawing of vertices </td></tr>
<tr>
<td><center>F6</center> </td><td>Toggle drawing of particle effects </td></tr>
<tr>
<td><center>Left arrow</center> </td><td>Hit for red words </td></tr>
<tr>
<td><center>Up arrow</center> </td><td>Hit for green words </td></tr>
<tr>
<td><center>Right arrow</center> </td><td>Hit for blue words </td></tr>
<tr>
<td><center>PrtScr (hold down)</center> </td><td>Save screenshot to a PNG file </td></tr>
<tr>
<td><center>Esc</center> </td><td>Quit game and close the window </td></tr>
</table>
</center><p><a class="anchor" id="section3"></a></p><h1>3. Building the Game</h1>
<p>This code uses <a href="../sage/index.html">SAGE</a> and <a href="https://github.com/erincatto/Box2D">Box2D</a>. Make sure that you have followed the <a href="../install/index.html">SAGE Installation Instructions</a> and the <a href="../installphysics/index.html">Box2D Installation Instructions</a>. Navigate to the folder <span style="background-color:#D8E4D8;"><code>12. Stroop Test Game</code></span> in your copy of the <span style="background-color:#D8E4D8;"><code>sage-physics</code></span> repository. Run <span style="background-color:#D8E4D8;"><code>checkenv.bat</code></span> to verify that you have set the environment variables correctly. Open <span style="background-color:#D8E4D8;"><code>Stroop Test Game.sln</code></span> with Visual Studio and build the Release configuration. Alternatively, run <span style="background-color:#D8E4D8;"><code>Build.bat</code></span> to build both Release and Debug configurations.</p>
<p><a class="anchor" id="section4"></a></p><h1>4. Game Play</h1>
<p><a class="anchor" id="fig3"></a></p><div class="image">
<img src="word.png" alt="" width="60%"/>
<div class="caption">
Fig. 3: A colored color word dropping from the top of the window.</div></div>
<p>After a few explanatory pages have been displayed the main part of the game begins and a series of colored words drops from the top of the window, passing through horizontal regions marked <em>excellent</em>, <em>good</em>, and <em>fair</em> at the left of the window. The player must hit a key (see <a class="el" href="#section2">Section 2</a>) corresponding to the word (not its color) before the word falls to the bottom of the window and goes out of play, at which time it turns black and spawns a cloud of bubbles. Only one word will be in play at a time and that word will be the only one that is red, green, or blue (see <a class="el" href="#fig3">Fig. 3</a>). If the player manages to hit the correct key before the word goes out of play, then the word will explode, generating a smoke cloud and a spray of letters in all directions. The bubbles, which are totally gratuitous except for serving as a distraction to the player, drift generally upwards and are blown about by passing words and by explosions.</p>
<p>At the bottom of the window is a score bar that keeps track of, from left to right, the number of words dropped, the number exploded in the <em>excellent</em> region, the number exploded in the <em>good</em> region, the number exploded in the <em>fair</em> region, the number that the player got wrong (hitting the wrong key). the number that the player missed (not hitting a key before the word goes out of play), and a somewhat dubious score (which can be negative) computed from these statistics. As you might expect, you get more points for correctly exploding a word in the <em>excellent</em> region than you do for exploding a word in the <em>good</em> region, which in turn gives you more points than you do for exploding a word in the <em>fair</em> region. This means that you must be both fast and accurate to get a high score. Out-of-play words at the bottom of the screen will eventually explode but do not contribute to the score. These unexpected explosions are yet another distraction to the player, as is the fact that the image of John Ridley Stroop (the inventor of the Stroop test) at the right of the window moves its eyes to follow the current word in play.</p>
<p>The bubbles mentioned in the previous paragraph are blown about by a <em>vector field</em>. We place evenly spaced grid points throughout the play area, and at each point we store a floating point <em>pressure</em> and a vector (hence the name <em>vector field</em>). Pressure is increased in front of a falling word and reduced behind it. For example <a class="el" href="#fig4">Fig. 4</a> shows in various shades of brown, with darker shades indicating higher pressure.</p>
<p><a class="anchor" id="fig4"></a></p><div class="image">
<img src="pressure.png" alt="" width="60%"/>
<div class="caption">
Fig. 4: Air pressure (darker means higher pressure).</div></div>
<p>The vectors point from grid points with higher pressure towards a nearby area with lower pressure, as shown in <a class="el" href="#fig5">Fig. 5</a>. The magnitude of each vector is proportional to the pressure difference.</p>
<p><a class="anchor" id="fig5"></a></p><div class="image">
<img src="arrows.png" alt="" width="60%"/>
<div class="caption">
Fig. 5: Arrows from high pressure to low pressure.</div></div>
<p>The grid points are also shown with the vectors in <a class="el" href="#fig6">Fig. 6</a>.</p>
<p><a class="anchor" id="fig6"></a></p><div class="image">
<img src="dots.png" alt="" width="60%"/>
<div class="caption">
Fig. 6: Vector field points.</div></div>
<p>These effects are not intended for use in the game - they are just there to show programmers what is going on behind the scenes. They can be toggled on an off using the function keys listed in <a class="el" href="#section2">Section 2</a>.</p>
<p><a class="anchor" id="section5"></a></p><h1>5. Code Breakdown</h1>
<p>This section is divided into four subsections, one for each of the most important physics-oriented parts of the code. <a class="el" href="#section5-1">Section 5.1</a> describes the <em>vector field</em> used to create the wind that blows the bubbles around, <a class="el" href="#section5-2">Section 5.2</a> describes the <em>bubble engine</em> which manages the bubbles, <a class="el" href="#section5-3">Section 5.3</a> describes the John Stroop caricature, and <a class="el" href="#section5-4">Section 5.4</a> describes how the colored words are created, maintained, and destroyed.</p>
<p><a class="anchor" id="section5-1"></a></p><h2>5.1 The Vector Field</h2>
<p>The vector field shown in <a class="el" href="#fig5">Fig. 5</a> is implemented in <code><a class="el" href="class_c_vector_field.html" title="A vector field.">CVectorField</a></code>. The field points, called <em>vertices</em>, shown in <a class="el" href="#fig6">Fig. 6</a> are stored there in a 2D array of instances <code><a class="el" href="class_c_vertex.html" title="A vertex in a vector field.">CVertex</a></code>. A single instance of <code><a class="el" href="class_c_vector_field.html" title="A vector field.">CVectorField</a></code> is created in <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code> and a pointer to that instance is stored in <code><a class="el" href="class_c_common.html#a2d3f2b22002d06279cdaa2a364d6f616" title="Pointer to a vector field.">CCommon::m_pVectorField</a></code> for common use. <code><a class="el" href="class_c_vertex.html" title="A vertex in a vector field.">CVertex</a></code> maintains a vector <code><a class="el" href="class_c_vertex.html#a0c3547e908399de75ab66b8bd959fe0a" title="Vector.">CVertex::m_vVector</a></code> for the wind direction at a vertex and a floating point <code><a class="el" href="class_c_vertex.html#aedea53700191d5c31160414c21419501" title="Pressure.">CVertex::m_fPressure</a></code> for the air pressure at a vertex.</p>
<p><code><a class="el" href="class_c_vector_field.html#a235d83e79a786c47db1c9a90cb44e9ee" title="Update pressures around moving object.">CVectorField::Update</a></code> is called once per letter from <code><a class="el" href="class_c_object_manager.html#a388377227dfb9471bb095d770c10ab35" title="Update all objects.">CObjectManager::Update</a></code>, with parameters describing the letter's position and velocity in Physics World. <code><a class="el" href="class_c_object_manager.html#a388377227dfb9471bb095d770c10ab35" title="Update all objects.">CObjectManager::Update</a></code> is called once per animation frame from <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame</a></code>. <code><a class="el" href="class_c_vector_field.html#a235d83e79a786c47db1c9a90cb44e9ee" title="Update pressures around moving object.">CVectorField::Update</a></code> finds the vertex closest to the letter using <code><a class="el" href="class_c_vector_field.html#a475e7a103eb142fe969b97a6f5d0d9cd" title="Closest vertex.">CVectorField::GetClosestVertex</a></code>. It then updates the pressure at that vertex by calling the private version of <code><a class="el" href="class_c_vector_field.html#a235d83e79a786c47db1c9a90cb44e9ee" title="Update pressures around moving object.">CVectorField::Update</a></code>. Air pressures are also drastically changed at vertices close to an explosion when <code><a class="el" href="class_c_vector_field.html#ac8380c325eb531cb67dc4542b9d40bce" title="Detonation.">CVectorField::Detonate</a></code>, which is called from <code><a class="el" href="class_c_object_manager.html#a3f8f756746cbe9eed0808ad6befabe2e" title="Animate a joint explosion.">CObjectManager::AnimateJointExplosion</a></code> when a word explodes due to user input or <code><a class="el" href="class_c_object_manager.html#a826fd65977bfd2461975e57938a108a8" title="Explode old words.">CObjectManager::ExplodeOldWords</a></code> expiration, and from <code>ExplodeOldLetters</code> when expired letters themselves explode. Vectors and pressures are smoothed out by calling <code><a class="el" href="class_c_vector_field.html#a9cce679699146ba9f4ca5728f010afdb" title="Perform an animation step.">CVectorField::Step</a></code> once per frame from <code><a class="el" href="class_c_object_manager.html#a388377227dfb9471bb095d770c10ab35" title="Update all objects.">CObjectManager::Update</a></code>.</p>
<p><a class="anchor" id="section5-2"></a></p><h2>5.2 The Bubble Engine</h2>
<p>The bubbles emitted when the words collide with the bottom edge (for example, see <a class="el" href="#fig2">Fig. 2</a>) are managed by a <em>bubble engine</em>. The bubble engine is implemented in <code><a class="el" href="class_c_bubble_engine.html" title="A particle engine for bubbles.">CBubbleEngine</a></code>, which is a specialized particle engine derived from <a href="../sage/index.html#sec3-8"><code>Sage::Sage::CParticleEngine2D</code></a>. A single instance of <code><a class="el" href="class_c_bubble_engine.html" title="A particle engine for bubbles.">CBubbleEngine</a></code> is created in <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code> and a pointer to that instance is stored in <code><a class="el" href="class_c_common.html#a809702dd704f656f0772a1b4c31a664c" title="Pointer to a bubble engine.">CCommon::m_pBubbleEngine</a></code> for common use. Its constructor <code><a class="el" href="class_c_bubble_engine.html#a0aad864d30a3b01be88e48ab7261ce3a" title="Constructor.">CBubbleEngine::CBubbleEngine</a></code> takes a pointer to an instance of <code><a class="el" href="class_c_vector_field.html" title="A vector field.">CVectorField</a></code> which is stores in <code><a class="el" href="class_c_bubble_engine.html#afd49aed999ad016ff8cfd33233336c69" title="Pointer to a vector field.">CBubbleEngine::m_pVectorField</a></code>. <code><a class="el" href="class_c_bubble_engine.html" title="A particle engine for bubbles.">CBubbleEngine</a></code> has a function <code><a class="el" href="class_c_bubble_engine.html#ad3890552c8fb9f0a7d5f2a5e70e87888" title="Animation step.">CBubbleEngine::Step</a></code> that is called once per animation from from <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame</a></code>. <code><a class="el" href="class_c_bubble_engine.html#ad3890552c8fb9f0a7d5f2a5e70e87888" title="Animation step.">CBubbleEngine::Step</a></code> iterates through a list of bubbles and adds to the velocity of each bubble a constant times the vector stored in the closest grid point in the vector field pointed to by <code><a class="el" href="class_c_bubble_engine.html#afd49aed999ad016ff8cfd33233336c69" title="Pointer to a vector field.">CBubbleEngine::m_pVectorField</a></code> (see <a class="el" href="#section5-1">Section 5.1</a>).</p>
<p><a class="anchor" id="section5-3"></a></p><h2>5.3 The John Stroop Caricature</h2>
<p>The caricature of John Stroop with swivelling eyeballs is implemented in <code><a class="el" href="class_c_stroop.html" title="A caricature of John Ridley Stroop with swivelling eyeballs.">CStroop</a></code>. The shape outlining his head is a simple list of <code>b2EdgeShape</code> created in the constructor <code><a class="el" href="class_c_stroop.html#a331d6b116b43433592849e26ee8201da" title="Constructor.">CStroop::CStroop</a></code>. It would be tempting to use <code>b2PolygonShape</code> instead, but unfortunately Box2D only allows a small number of vertices, and additionally the polygon must be convex, which as <a class="el" href="#fig7">Fig. 7</a> shows, John Stroop's head is definitely not. <code><a class="el" href="class_c_stroop.html#a331d6b116b43433592849e26ee8201da" title="Constructor.">CStroop::CStroop</a></code> has a local array <code>v2Stroop</code> with <code>NUMPOINTS = 46</code> points that were read from the sprite image using an image editor.</p>
<p><a class="anchor" id="fig7"></a></p><div class="image">
<img src="shapes.png" alt="" width="60%"/>
<div class="caption">
Fig. 7: Shapes in Physics World overlaying the sprites.</div></div>
<p><a class="anchor" id="section5-4"></a></p><h2>5.4 The Words</h2>
<p>Each letter of the colored words is implemented as an instance of <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code>. These are managed by an instance of <code><a class="el" href="class_c_object_manager.html" title="The Object Manager.">CObjectManager</a></code>. <code><a class="el" href="class_c_object_manager.html#a9cd9848b67155361f36449fb69d3b98e" title="Create world edges.">CObjectManager::CreateWorldEdges</a></code> creates the Physics World shapes for the world edges at the left and right sides of the window and at the top of the score bar as shown in <a class="el" href="#fig7">Fig. 7</a>. Compare this to <a class="el" href="#fig3">Fig. 3</a> for example. The shapes for each word are created in <code><a class="el" href="class_c_object_manager.html#aaaa2f8b98ebfac222900ecde3bc8136f">CObjectManager::CreateWord</a></code>. As you can see in in <a class="el" href="#fig7">Fig. 7</a>, each letter is a <code>b2PolygonShape</code> set using <code>b2PolygonShape::SetAsBox</code>. The letters are connected in sequence using <code>b2WeldJoint</code>s. <code><a class="el" href="class_c_object_manager.html#aaaa2f8b98ebfac222900ecde3bc8136f">CObjectManager::CreateWord</a></code> is called from <code><a class="el" href="class_c_object_manager.html#ab27481b747d45dabc1ec7c1df8e89721" title="Create random word.">CObjectManager::CreateRandomWord</a></code>, which is called periodically from <code><a class="el" href="class_c_game.html#a4348d4eda6cc858625e8cac09dcc1e7d" title="Process game state.">CGame::ProcessState</a></code> when the game state <code><a class="el" href="class_c_common.html#a9d903bcaf258c092ebb5fdaf669ff014" title="Current game state.">CCommon::m_eGameState</a></code> is <code>eGameState::Playing</code>. <code><a class="el" href="class_c_game.html#a4348d4eda6cc858625e8cac09dcc1e7d" title="Process game state.">CGame::ProcessState</a></code> is called from <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame</a></code>, which is automatically called once per animation frame. Word explosion is handled by <code><a class="el" href="class_c_object_manager.html#a826fd65977bfd2461975e57938a108a8" title="Explode old words.">CObjectManager::ExplodeOldWords</a></code>, which destroys the joints between the letters and applies an impulse to each letter (we have already seen something similar in the <a href="../cannon/index.html#section5-1-3">Cannon Game</a> when the cannon explodes).</p>
<p><a class="anchor" id="section6"></a></p><h1>6. What Next?</h1>
<p>Next, take a look at the <a href="../binary/index.html">Binary Counter Toy</a>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
