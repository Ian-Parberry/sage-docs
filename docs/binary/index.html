<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Box2D Binary Counter: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="sagedoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="counter.png"/></td>
  <td id="projectalign">
   <div id="projectname">Box2D Binary Counter
   </div>
   <div id="projectbrief">Game Physics with a 2D Physics Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="contents">
<div class="textblock"><p><a class="anchor" id="section1"></a></p><h1>1. Introduction</h1>
<p>This toy uses Box2D to implement a 5-bit gravity-driven ripple-carry counter that counts from zero to \(2^5 - 1 = 31\). There is an LED readout for the number of balls released and an array of nixie tubes showing that number in binary. It takes a few seconds for the carry to ripple down after the release of a new ball, after which the current binary number represented by the soccer balls is read aloud and the corresponding soccer balls (or lack of them) highlighted by a spinning reticle. <a class="el" href="#fig1">Fig. 1</a> shows the counter in its initial state, that is, at value zero.</p>
<p><a class="anchor" id="fig1"></a></p><div class="image">
<img src="screenshot.png" alt="" width="60%"/>
<div class="caption">
Fig. 1: Screen shot in the initial configuration (zero).</div></div>
<p>The remainder of this page is divided into five sections. <a class="el" href="#section2">Section 2</a> lists the controls and their corresponding actions, <a class="el" href="#section3">Section 3</a> tells you how to build it, <a class="el" href="#section4">Section 4</a> gives you a list of actions to take in the game to see some of its important features, <a class="el" href="#section5">Section 5</a> gives a breakdown of the code, and <a class="el" href="#section6">Section 6</a> addresses the question "what next?".</p>
<p><a class="anchor" id="section2"></a></p><h1>2. Keyboard Controls</h1>
<center> <table class="doxtable">
<tr>
<td><center><b>Key</b></center> </td><td><center><b>Action</b></center> </td></tr>
<tr>
<td><center>F1</center> </td><td>Help (this document) </td></tr>
<tr>
<td><center>F2</center> </td><td>Toggle draw mode from "sprites only", to "sprites and lines", to "lines only" </td></tr>
<tr>
<td><center>Backspace</center> </td><td>Reset </td></tr>
<tr>
<td><center>Space</center> </td><td>Release the next ball to increment the counter </td></tr>
<tr>
<td><center>PrtScr (hold down)</center> </td><td>Save screenshot to a PNG file </td></tr>
<tr>
<td><center>Esc</center> </td><td>Quit game and close the window </td></tr>
</table>
</center><p><a class="anchor" id="section3"></a></p><h1>3. Building the Game</h1>
<p>This code uses <a href="../sage/index.html">SAGE</a> and <a href="https://github.com/erincatto/Box2D">Box2D</a>. Make sure that you have followed the <a href="../install/index.html">SAGE Installation Instructions</a> and the <a href="../installphysics/index.html">Box2D Installation Instructions</a>. Navigate to the folder <span style="background-color:#D8E4D8;"><code>13. Binary Counter Toy</code></span> in your copy of the <span style="background-color:#D8E4D8;"><code>sage-physics</code></span> repository. Run <span style="background-color:#D8E4D8;"><code>checkenv.bat</code></span> to verify that you have set the environment variables correctly. Open <span style="background-color:#D8E4D8;"><code>Binary Counter Toy.sln</code></span> with Visual Studio and build the Release configuration. Alternatively, run <span style="background-color:#D8E4D8;"><code>Build.bat</code></span> to build both Release and Debug configurations.</p>
<p><a class="anchor" id="section4"></a></p><h1>4. Game Play</h1>
<p><a class="anchor" id="fig2"></a></p><div class="image">
<img src="zero-one.png" alt="" width="40%"/>
<div class="caption">
Fig. 2: Single bit counter showing a 0 (left) and a 1 (right).</div></div>
<p>The key to this toy is the single-bit counter shown in <a class="el" href="#fig2">Fig. 2</a>. Bits that are 1 are represented by soccer balls. Bits that are zero are represented by the lack of a soccer ball. For example, the image on the left of <a class="el" href="#fig3">Fig. 2</a> represents a 0, and the image on the right of <a class="el" href="#fig3">Fig. 2</a> represents a 1.</p>
<p><a class="anchor" id="fig3"></a></p><div class="image">
<img src="labels.png" alt="" width="60%"/>
<div class="caption">
Fig. 3: Labelled screen shot.</div></div>
<p><a class="el" href="#fig3">Fig. 3</a> shows the parts of the binary counter toy. There are five bits, which means that the counter can count from zero to \(2^5 - 1 = 31\). Each bit is represented by a copy of the device from <a class="el" href="#fig2">Fig. 2</a> (left). arranged from right to left, top to bottom. That means that the least significant bit (the one representing \(2^0=1\)) is at top right (<a class="el" href="#fig3">Fig. 3</a>(a)) and the most significant bit (representing \(2^4 = 16\)) is at bottom left (<a class="el" href="#fig3">Fig. 3</a>(b)). The current value of the counter can be read off from right to left using the soccer balls in binary, from left to right in the binary counter display (<a class="el" href="#fig3">Fig. 3</a>(c)), and in decimal in the binary counter display (see <a class="el" href="#fig3">Fig. 3</a>(d)). Any attempt to count to \(32\) will result in the overflow light (see <a class="el" href="#fig3">Fig. 3</a>(e)) flashing red.</p>
<p><a class="anchor" id="fig4"></a></p><div class="image">
<img src="count512.gif" alt=""/>
<div class="caption">
Fig. 4: Rest states while counting.</div></div>
<p><a class="el" href="#fig4">Fig. 4</a> shows an animation of the rest states, that is, the screen shown when the balls have come to rest and the game is waiting for the user to release the next ball (see <a class="el" href="#section2">Section 2</a> for keyboard controls). Pay attention to the soccer balls, the binary counter, and the decimal counter (refer back to <a class="el" href="#fig3">Fig. 3</a> is necessary). Let's look a little closer at what happens to a single bit when incrementing from 0 to 1, then incrementing from 1 to 0 resulting in a carry bit. This is shown in <a class="el" href="#fig5">Fig. 5</a>.</p>
<p><a class="anchor" id="fig5"></a></p><div class="image">
<img src="frames.png" alt="" width="90%"/>
<div class="caption">
Fig. 5: Actions when incrementing a single bit twice.</div></div>
<p><a class="el" href="#fig5">Fig 5</a>(a) shows a single zero bit. When a ball is released (either a carry from the previous bit or, if it's the least significant bit, then from the top of window when the user hits the increment key as described in <a class="el" href="#section2">Section 2</a>), it falls onto the top right platform and rolls right as shown in <a class="el" href="#fig5">Fig 5</a>(b) and gets trapped in the pit shown in <a class="el" href="#fig5">Fig 5</a>(c). The bit has now been incremented from 0 to 1. Now we show what happens when we increment from 1 to 0. The next ball again enters from top right, but this time it rolls over the ball in the pit and down the slope on the left of <a class="el" href="#fig5">Fig 5</a>(d). It hits the lower platform in <a class="el" href="#fig5">Fig 5</a>(e) and rolls right, having been deflected by the slope. This ball hits the vertical leg holding up a swing arm at the bottom of the pit containing the previous ball and exits the toy to the right of <a class="el" href="#fig5">Fig 5</a>(f), ending up with a collection of balls at the bottom of the window. The previous ball is released in <a class="el" href="#fig5">Fig 5</a>(f) and rolls to the left in <a class="el" href="#fig5">Fig 5</a>(g) on the lower platform, which is in fact the upper platform of the next bit counter. This is the carry bit. Meanwhile, when released of the weight of the carry ball, the swing arm returns to its initial position in <a class="el" href="#fig5">Fig 5</a>(h).</p>
<p><a class="anchor" id="section5"></a></p><h1>5. Code Breakdown</h1>
<p>Let \(x\) and \(y\) be single bits. When \(x\) and \(y\) are added together, the result is the exclusive-or \(z = x \oplus y\) and the carry bit is the conjunction \(x \wedge y\). This gives us the single-bit counter shown in <a class="el" href="#fig6">Fig. 6</a>.</p>
<p><a class="anchor" id="fig6"></a></p><div class="image">
<img src="bitadd.png" alt="" width="9%"/>
<div class="caption">
Fig. 6: Single bit counter.</div></div>
<p>Our single bit counter consists of two rectangular <em>blocks</em> (<em>primary</em> and <em>secondary</em>), a triangular <em>ramp</em>, a rectangular <em>swing arm</em>, and two rectangular <em>legs</em>, and three revolute joints as shown in <a class="el" href="#fig7">Fig. 7</a>. There is a revolute joint at the center of the swing arm connecting it to the null background, and a revolute joint at the top of each leg joining it to one of the two ends of the swing arm. It is implemented in code by <code><a class="el" href="class_c_bit_counter.html" title="Single-bit counter.">CBitCounter</a></code>. Its constructor <code><a class="el" href="class_c_bit_counter.html#a966655d68d0c450d9f3a19965e29bfad" title="Constructor.">CBitCounter::CBitCounter</a></code> takes as parameters the coordinates of its center in render world coordinates and a Boolean variable that is true if this is the last (i.e. null) bit counter. It uses <code><a class="el" href="class_c_bit_counter.html#aee754ea7f63dbb5a76ef261362d7227f" title="Create a triangular ramp.">CBitCounter::CreateRamp</a></code> to create the ramp and <code><a class="el" href="class_c_bit_counter.html#a2f2d4c2fe8c17ffe43a331101a9bc940" title="Create a block.">CBitCounter::CreateBlock</a></code> to create the blocks, swing arm, and legs.</p>
<p><a class="anchor" id="fig7"></a></p><div class="image">
<img src="bitshape1.png" alt="" width="35%"/>
<div class="caption">
Fig. 7: Shapes and joints for single bit counter.</div></div>
<p>Now suppose we wish to increment the binary number \(x_4x_3x_2x_1x_0\) to get the result \(z_4z_3z_2z_1z_0\) and an overflow bit. We simply cascade five single bit counters with the carry from one going to the input of the next as shown in <a class="el" href="#fig8">Fig. 8</a>. This should be familiar to you if you have taken an elementary hardware or computer organization class.</p>
<p><a class="anchor" id="fig8"></a></p><div class="image">
<img src="add.png" alt="" width="30%"/>
<div class="caption">
Fig. 8: Ripple-carry counter with 5 bits.</div></div>
<p>Our ripple-carry increment will be constructed from five single-bit counters as shown in <a class="el" href="#fig7">Fig. 7</a> spaced out vertically and shifted to the left so that the carry from one becomes the input to the next. Its left leg will rest on the primary block of the single bit counter below it so that the ball can rest on it when the it has value 1 as shown in <a class="el" href="#fig8">Fig. 9</a>. There will be a sixth sentinel single bit counter that consists of just the primary block.</p>
<p><a class="anchor" id="fig9"></a></p><div class="image">
<img src="bitshape2.png" alt=""/>
<div class="caption">
Fig. 9: Shapes for single bit counter at 1.</div></div>
<p>Our counter is implemented as an instance of <code><a class="el" href="class_c_counter.html" title="Binary counter.">CCounter</a></code>, which stores an array of pointers to instances of <code><a class="el" href="class_c_bit_counter.html" title="Single-bit counter.">CBitCounter</a></code> created in its constructor. An instance of <code><a class="el" href="class_c_counter.html" title="Binary counter.">CCounter</a></code> is created in <code><a class="el" href="class_c_object_manager.html#aa2d13426f50a3bb1768245ea68e5d844" title="Create counter.">CObjectManager::CreateCounter</a></code> which is called from <code><a class="el" href="class_c_game.html#af7200bd66587e10002e7ed9e4a1f930e" title="Begin playing the game.">CGame::BeginGame</a></code>.</p>
<p><a class="anchor" id="section6"></a></p><h1>6. What Next?</h1>
<p>Next, take a look at the <a href="../lullaby/index.html">Cannon Lullaby Toy</a>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
