<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Pinball Game: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="sagedoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">The Pinball Game
   </div>
   <div id="projectbrief">Game Physics with Bespoke Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="contents">
<div class="textblock"><p><a class="anchor" id="section1"></a></p><h1>1. Introduction</h1>
<p>This is a rudimentary pinball machine designed to put the <a href="../shapes/index.html">Shapes Library</a> library we developed for the <a href="../collisionmath/index.html">Collision Math Toy</a> to good use. The aim of the game is to get as high a score as you can. In addition to being a minigame that you can actually play, the Pinball Game allows the player to change the draw mode from the normal "sprites only" mode in which the game will be shipped (<a class="el" href="#fig1">Fig. 1</a>, left), a "sprites and lines" mode in which the shapes are drawn in black over the sprites so that you can check that the sprites actually align with the shapes (<a class="el" href="#fig1">Fig. 1</a>, middle), and "lines only" mode (<a class="el" href="#fig1">Fig. 1</a>, right) because it looks cool. The game can be played in any of the three draw modes.</p>
<p><a class="anchor" id="fig1"></a></p><div class="image">
<img src="screenshot.png" alt="" width="60%"/>
<div class="caption">
Fig. 1: Screen shot.</div></div>
<p>The remainder of this page is divided into five sections. <a class="el" href="#section2">Section 2</a> lists the controls and their corresponding actions, <a class="el" href="#section3">Section 3</a> tells you how to build it, <a class="el" href="#section4">Section 4</a> gives you a list of actions to take in the game to see some of its important features, <a class="el" href="#section5">Section 5</a> gives a breakdown of the code, <a class="el" href="#section6">Section 6</a> contains some programming problems, and <a class="el" href="#section7">Section 7</a> addresses the question "what next?".</p>
<p><a class="anchor" id="section2"></a></p><h1>2. Controls</h1>
<center> <table class="doxtable">
<tr>
<td><center><b>Key</b></center> </td><td><center><b>Action</b></center> </td></tr>
<tr>
<td><center>F1</center> </td><td>Help (this document) </td></tr>
<tr>
<td><center>F2</center> </td><td>Toggle draw mode from "sprites only", to "sprites and lines", to "lines only" </td></tr>
<tr>
<td><center>Space</center> </td><td>Load a ball (first press) and launch it (second press) </td></tr>
<tr>
<td><center>Left shift</center> </td><td>Left flipper up while key is down </td></tr>
<tr>
<td><center>Right shift</center> </td><td>Right flipper up while key is down </td></tr>
<tr>
<td><center>PrtScr (hold down)</center> </td><td>Save screenshot to a PNG file </td></tr>
<tr>
<td><center>Esc</center> </td><td>Quit game and close the window </td></tr>
</table>
</center><p><a class="anchor" id="section3"></a></p><h1>3. Building the Game</h1>
<p>This code uses <a href="../sage/index.html">SAGE</a> and the <a href="../shapes/index.html">Shapes Library</a>. Make sure that you have followed the <a href="../install/index.html">SAGE Installation Instructions</a> and the <a href="../shapes/index.html#section3">Shapes Library Build Instructions</a>. Navigate to the folder <span style="background-color:#D8E4D8;"><code>4. Pinball Game</code></span> in your copy of the <span style="background-color:#D8E4D8;"><code>sage-physics</code></span> repository. Run <span style="background-color:#D8E4D8;"><code>checkenv.bat</code></span> to verify that you have set the environment variables correctly. Open <span style="background-color:#D8E4D8;"><code>Pinball Game.sln</code></span> with Visual Studio and build the Release configuration. The Release executable file <span style="background-color:#D8E4D8;"><code>Pinball Game.exe</code></span> will appear. Alternatively, run <span style="background-color:#D8E4D8;"><code>Build.bat</code></span> to build both Release and Debug configurations.</p>
<p><a class="anchor" id="section4"></a></p><h1>4. Game Play</h1>
<p>Do I have to tell you how to play <a href="https://en.wikipedia.org/wiki/Pinball">pinball</a>? Refer back to <a class="el" href="#section2">Section 2</a> to see the flipper and ball launch keys.</p>
<p><a class="anchor" id="section5"></a></p><h1>5. Code Breakdown</h1>
<p>This code uses the <a href="../shapes/index.html">Shapes Library</a> and some code from the <a href="../collisionmath/index.html">Collision Math Toy</a> to make a rudimentary pinball game. The most challenging part of the code is the creation of the shapes in the play area as shown in <a class="el" href="#fig1">Fig. 1</a>, right. This is done in <code><a class="el" href="class_c_game.html#af7200bd66587e10002e7ed9e4a1f930e" title="Begin playing the game.">CGame::BeginGame</a></code> by calling <code><a class="el" href="class_c_object_manager.html#a1dcdb4b8172c7657d398b966381ae006" title="Create shapes for world edges.">CObjectManager::MakeWorldEdges</a></code> to make various static edges and arcs, and <code><a class="el" href="class_c_object_manager.html#a31136d0aefd25d97932dca283f7e58a0" title="Create shapes.">CObjectManager::MakeShapes</a></code> to make the other various shapes, which in turn calls <code><a class="el" href="class_c_object_manager.html#ae1c594c6824929eb9ba84f336045ae3d" title="Make a bumper.">CObjectManager::MakeBumper</a></code>, <code><a class="el" href="class_c_object_manager.html#a8ec3facaf9550165947643f51e5265c7" title="Make a bollard.">CObjectManager::MakeBollard</a></code>, <code><a class="el" href="class_c_object_manager.html#abaa1d5ffeaee29261db5eae35a03487c" title="Make a flipper.">CObjectManager::MakeFlipper</a></code>, <code><a class="el" href="class_c_object_manager.html#a3c7fbcf613ac5cc2836d5e789ad4be20" title="Make a thing (left).">CObjectManager::MakeThingL</a></code>, <code><a class="el" href="class_c_object_manager.html#a08f704845cf30b46b8a59a3ce49d5419" title="Make a thing (right).">CObjectManager::MakeThingR</a></code>, and <code><a class="el" href="class_c_object_manager.html#a6c230a9e32ea2869acc9d1916e490df0" title="Make a shape.">CObjectManager::MakeShape</a></code>.</p>
<p><a class="anchor" id="section6"></a></p><h1>6. Problems</h1>
<p>For the following problems you can either work directly in the folder <span style="background-color:#D8E4D8;"><code>4. Pinball Game</code></span> in your copy of the <span style="background-color:#D8E4D8;"><code>sage-physics</code></span> repository, or (recommended) make a copy of the folder <span style="background-color:#D8E4D8;"><code>4. Pinball Game</code></span> in some place convenient (for example, the Desktop or your <code>Documents</code> folder) and work there.</p>
<p><a class="anchor" id="problem4-1"></a></p><h2>Problem 4.1</h2>
<div style="padding-left: 30px;" markdown="1"> Add the following function to <code><a class="el" href="class_c_object_manager.html" title="The object manager.">CObjectManager</a></code> to create a regular polygonal bumper with <code>n</code> sides, centered at <code>p</code>, with elasticity <code>e</code>, sprites <code>unlit</code> and <code>lit</code>, which when hit makes sound <code>snd</code> and adds <code>nScore</code> to the score. Each polygonal bumper will be an instance of <a href="../shapes/class_shapes_1_1_c_compound_shape.html"><code>Shapes::CCompoundShape</code></a>. <pre class="fragment">void CObjectManager::MakeBumper(UINT n, const Vector2&amp; p, float e, 
  eSprite unlit, eSprite lit, eSound snd, int nScore)
{   
  if(n &lt; 3)ABORT("Too few edges in polygon");

  CObjDesc nullObjDesc(eSprite::None, eSprite::None, snd);
  CObjDesc bumperObjDesc(unlit, lit, snd);
  bumperObjDesc.m_nScore = nScore;

  CObjDesc lineDesc(eSprite::BlackLine, eSprite::BlackLine, snd);
  Shapes::CPointDesc pointDesc(p);

  Shapes::CShape* pCenterPoint = AddShape(&amp;pointDesc, bumperObjDesc);
  Shapes::CCompoundShape* pBumper = new Shapes::CCompoundShape(pCenterPoint); 
} //MakeBumper
</pre></div><div style="padding-left: 30px;" markdown="1">Append to the end of this function code to add the appropriate shapes from the <a href="../shapes/index.html">Shapes Library</a> to the compound shape pointed to by <code>pBumper</code>. Then in <code><a class="el" href="class_c_object_manager.html#a31136d0aefd25d97932dca283f7e58a0" title="Create shapes.">CObjectManager::MakeShapes</a></code>, replace the lines <pre class="fragment">MakeBumper(Vector2(mid + 14.0f - dx, y), e, unlit, lit, snd);
MakeBumper(Vector2(mid + 14.0f,      y), e, unlit, lit, snd);
MakeBumper(Vector2(mid + 14.0f + dx, y), e, unlit, lit, snd);
</pre></div><div style="padding-left: 30px;" markdown="1">with the following lines <pre class="fragment">Vector2 pos = Vector2(mid + 14.0f - dx, y);
MakeBumper(3, pos, e, eSprite::UnlitTriangle, eSprite::LitTriangle, snd, 10);
pos.x += dx;
MakeBumper(4, pos, e, eSprite::UnlitSquare, eSprite::LitSquare, snd, 100);
pos.x += dx;
MakeBumper(5, pos, e, eSprite::UnlitPentagon, eSprite::LitPentagon, snd, 100);
</pre></div><div style="padding-left: 30px;" markdown="1">Your game should now look like <a class="el" href="#fig2">Fig. 2</a> left, with the collision shapes in <a class="el" href="#fig2">Fig. 2</a> right aligned with the edges of the polygons. When you play the game the balls should collide correctly with the polygon edges and points, but the bumpers will not light up. That is the subject of the next question. </div><p><a class="anchor" id="fig2"></a></p><div class="image">
<img src="screenshot2.png" alt="" width="60%"/>
<div class="caption">
Fig. 2: Screen shot with polygonal bumpers.</div></div>
<p><a class="anchor" id="problem4-2"></a></p><h2>Problem 4.2</h2>
<div style="padding-left: 30px;" markdown="1"> After completing <a class="el" href="#problem4-1">Problem 4.1</a>, add code to <code><a class="el" href="class_c_object_manager.html#a3c574bccab311aa7259137f9bcf096af" title="Narrow phase collision detection and response.">CObjectManager::NarrowPhase</a></code> to make the polygonal bumpers light up when hit.</div><div style="padding-left: 30px;" markdown="1"><h3>Hints:</h3>
</div><div style="padding-left: 30px;" markdown="1"></div><div style="padding-left: 30px;" markdown="1">Keep a vector of pointers to the new polygons <pre class="fragment">std::vector&lt;Shapes::CCompoundShape*&gt; m_vBumperList;
</pre></div><div style="padding-left: 30px;" markdown="1">and push a pointer to each polygonal bumper to the back of it in your function <code><a class="el" href="class_c_object_manager.html#ae1c594c6824929eb9ba84f336045ae3d" title="Make a bumper.">CObjectManager::MakeBumper</a></code> from <a class="el" href="#problem4-1">Problem 4.1</a>. Then at the end of <code><a class="el" href="class_c_object_manager.html#a3c574bccab311aa7259137f9bcf096af" title="Narrow phase collision detection and response.">CObjectManager::NarrowPhase</a></code>, if the local variable <code>bHit</code> is <code>true</code> then use the function <a href="../shapes/class_shapes_1_1_c_compound_shape.html#abef3eafc01c529d2d9618be7c3fc604e"><code>CCompoundshape::IsPartOf</code></a> to check whether <code>pShape</code> is a part of each bumper. If so, then get the bumper's central point using <a href="../shapes/class_shapes_1_1_c_compound_shape.html#a70c09b0cf7fe31caa0f793d589a398cc"><code>CCompoundShape::GetCenterPoint</code></a>, then get a pointer to the bumper object by using that point's <a href="../shapes/class_shapes_1_1_c_shape.html#a712df6c7164d15900bddefc1a16d0136"><code>CShape::GetUserPtr</code></a> function and casting it to <code>CObject*</code>. You can then set the object's <code><a class="el" href="class_c_object.html#a67c7e06d8d32dc902184af9d7cd9f399" title="Was hit recently.">CObject::m_bRecentHit</a></code> and <code><a class="el" href="class_c_object.html#afa9693e6f5b689b74ef5c7edc7a03836" title="Time of last hit.">CObject::m_fLastHitTime</a></code> to the appropriate values, which will then make the bumpers light up when hit. </div><p><a class="anchor" id="section7"></a></p><h1>7. What Next?</h1>
<p>Next, take a look at the <a href="../ballandspring/index.html">Ball and Spring Toy</a>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
