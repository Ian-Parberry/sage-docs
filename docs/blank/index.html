<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Blank Game: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Game.png"/></td>
  <td id="projectalign">
   <div id="projectname">The Blank Game
   </div>
   <div id="projectbrief">A Blank 2D Game with Sound and a Sprite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="contents">
<div class="textblock"><p><a class="anchor" id="section1"></a></p><h1>1. Introduction</h1>
<p>This is pretty much what it says, a blank 2D game with a grassy hill in the background and a rotating sprite of some amusing text (see <a class="el" href="index.html#fig1">Fig. 1</a>). Its purpose is to get you started quickly on the basics of making a 2D game with SAGE (see <a class="el" href="index.html#section3">Section 3</a>). You can also use it to start development of a new game.</p>
<p><a class="anchor" id="fig1"></a></p><div class="image">
<img src="screenshot.png" alt="" width="30%"/>
<div class="caption">
Fig. 1: A screenshot of the Blank 2D Game.</div></div>
<p>The remainder of this page is divided into five sections. <a class="el" href="index.html#section2">Section 2</a> lists the keyboard controls and their corresponding actions, <a class="el" href="index.html#section3">Section 3</a> is a reminder to install SAGE, the Simple Academic Game Engine, <a class="el" href="index.html#section4">Section 4</a> describes the media used by the Blank Game, including images, sounds, and fonts, <a class="el" href="index.html#section5">Section 5</a> gives a breakdown of the code for the Blank Game, and <a class="el" href="index.html#section6">Section 6</a> addresses the question "what next?".</p>
<p><a class="anchor" id="section2"></a></p><h1>2. Keyboard Controls</h1>
<center> <table class="doxtable">
<tr>
<td><center><b>Key</b></center> </td><td><center><b>Action</b></center> </td></tr>
<tr>
<td>F1 </td><td>Help (this document) </td></tr>
<tr>
<td>F2 </td><td>Toggle frame rate display </td></tr>
<tr>
<td>Space Down </td><td>Play a clang sound </td></tr>
<tr>
<td>Space Up </td><td>Play a grunt sound </td></tr>
<tr>
<td>Backspace </td><td>Restart game </td></tr>
<tr>
<td>PrtScr (hold down) </td><td>Save screenshot to a PNG file </td></tr>
<tr>
<td>Esc </td><td>Quit game and exit </td></tr>
</table>
</center><p><a class="anchor" id="section3"></a></p><h1>3. SAGE</h1>
<p>This code uses <a href="../sage/index.html">SAGE</a>. Make sure that you have followed the <a href="../install/index.html">SAGE Installation Instructions</a>. Navigate to the folder <code>Blank 2D Game</code> in your copy of the <code>sage</code> repository. Run <code>checkenv.bat</code> to verify that you have set the environment variables correctly. Run <code>Build.bat</code>. The Release executable file <code>Blank Game.exe</code> will appear. When you run it you will see something similar to <a class="el" href="index.html#fig1">Fig. 1</a> with the text wheel rotating about its center. Experiment with the keyboard commands listed in <a class="el" href="index.html#section2">Section 2</a>.</p>
<p><a class="anchor" id="section4"></a></p><h1>4. Media</h1>
<p>The media for this game, consisting of fonts, images, sounds, and XML files, can be found in the folder <code>Media</code> in the solution folder. These can be found in sub-folders <code>Fonts</code>, <code>Images</code>, <code>Sounds</code>, and <code>XML</code>, respectively. You can change the names of the first three folders provided you also make the changes indicated in <a class="el" href="index.html#section4-4">Section 4.4</a>.</p>
<p>The remainder of this section is divided into four subsections describing fonts (<a class="el" href="index.html#section4-1">Section 4.1</a>), images (<a class="el" href="index.html#section4-2">Section 4.2</a>), sounds (<a class="el" href="index.html#section4-3">Section 4.3</a>), and XML files (<a class="el" href="index.html#section4-4">Section 4.4</a>).</p>
<p><a class="anchor" id="section4-1"></a></p><h2>4.1 Fonts</h2>
<p>The <code>Fonts</code> folder contains a font in <code>spritefont</code> format, <code>AverageSans_24.spritefont</code>. This font is licensed under the SIL Open Font License, Version 1.1, a copy of which you will find in file <code>OFL.txt</code>. It was converted to <code>spritefont</code> format using <a href="https://github.com/microsoft/DirectXTK12/wiki/SpriteFont">https://github.com/microsoft/DirectXTK12/wiki/SpriteFont</a>, which you can find in your DirectXTK12 download (provided you followed the instructions when you installed SAGE, see <a class="el" href="index.html#section3">Section 3</a>).</p>
<p><a class="anchor" id="section4-2"></a></p><h2>4.2 Images</h2>
<p>The <code>Images</code> folder contains two image files in <code>PNG</code> format. The background image <code>background.png</code> shown in <a class="el" href="index.html#fig2">Fig. 2</a>, and the text wheel shown in <a class="el" href="index.html#fig3">Fig. 3</a>. The file names can be changed provided you also make the changes indicated in <a class="el" href="index.html#section4-4">Section 4.4</a>.</p>
<p><a class="anchor" id="fig2"></a></p><div class="image">
<img src="background.png" alt="" width="30%"/>
<div class="caption">
Fig. 2: The background image.</div></div>
<p><a class="anchor" id="fig3"></a></p><div class="image">
<img src="textwheel.png" alt="" width="20%"/>
<div class="caption">
Fig. 3: The text wheel sprite.</div></div>
<p><a class="anchor" id="section4-3"></a></p><h2>4.3 Sounds</h2>
<p>The <code>Sounds</code> folder contains two sound files in <code>WAV</code> format. The file <code>clang.wav</code> contains a clang sound, and <code>umph.wav</code> contains a grunting sound. The file names can be changed provided you also make the changes indicated in <a class="el" href="index.html#section4-4">Section 4.4</a>. Note that the sound files must be in mono (single track) format, otherwise bad things might happen.</p>
<p><a class="anchor" id="section4-4"></a></p><h2>4.4 XML</h2>
<p>The <code>XML</code> folder contains a single XML file called <code>GameSettings.xml</code> that contains settings. The contents of the file are bracketed in <code>&lt;settings&gt;</code> and <code>&lt;/settings&gt;</code> tags.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">settings</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">settings</span>&gt;</div>
</div><!-- fragment --><p>The following tags can appear between these two tags in any order. the game and renderer tag (<a class="el" href="index.html#section4-4-1">Section 4.4.1</a>), the font tag (<a class="el" href="index.html#section4-4-2">Section 4.4.2</a>), the sprite tags (<a class="el" href="index.html#section4-4-3">Section 4.4.3</a>), and the sound tags (<a class="el" href="index.html#section4-4-4">Section 4.4.4</a>).</p>
<p><a class="anchor" id="section4-4-1"></a></p><h3>4.4.1 The Game and Renderer Tags</h3>
<p>The tag <code>&lt;game&gt;</code> lets you specify the name of the game, which will be displayed at the top of the game window. The tag <code>&lt;renderer&gt;</code> lets you specify the width and height in pixels of the user part of the game window.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">game</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Blank 2D Game&quot;</span> /&gt;</div>
<div class="line">&lt;<span class="keywordtype">renderer</span> <span class="keyword">width</span>=<span class="stringliteral">&quot;1024&quot;</span> <span class="keyword">height</span>=<span class="stringliteral">&quot;768&quot;</span>/&gt;</div>
</div><!-- fragment --><p><a class="anchor" id="section4-4-2"></a></p><h3>4.4.2 The Font Tag</h3>
<p>The tag <code>&lt;font&gt;</code> lets you specify the name and location of the text font file.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">font</span> <span class="keyword">file</span>=<span class="stringliteral">&quot;Media\Fonts\AverageSans_24.spritefont&quot;</span>/&gt;</div>
</div><!-- fragment --><p><a class="anchor" id="section4-4-3"></a></p><h3>4.4.3 The Sprite Tags</h3>
<p>The <code>&lt;sprites&gt;</code> tag lets you specify the path to the images folder. It is followed by a list of <code>&lt;sprite&gt;</code> tags, one for each sprite in the game including the background image, and is closed by a <code>&lt;/sprites&gt;</code> tag. Each <code>&lt;sprite&gt;</code> tag has a <code>name</code> field and a <code>file</code> field. The <code>name</code> field contains a string that will identify the sprite in the game's C++ code, and must be consistent with that code. The <code>file</code> field contains the name of the image file and may be changed without the need to recompile the game should you decide to rename the file. The <code>name</code> field and the <code>file</code> field for any given sprite may be completely different, should you feel the need to do so. The <code>&lt;sprite&gt;</code> tags may appear in any order inside the <code>&lt;sprites&gt;</code> and <code>&lt;/sprites&gt;</code> tags.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">sprites</span> <span class="keyword">path</span>=<span class="stringliteral">&quot;Media\Images&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">sprite</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;background&quot;</span> <span class="keyword">file</span>=<span class="stringliteral">&quot;background.png&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">sprite</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;textwheel&quot;</span> <span class="keyword">file</span>=<span class="stringliteral">&quot;textwheel.png&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sprites</span>&gt;</div>
</div><!-- fragment --><p><a class="anchor" id="section4-4-4"></a></p><h3>4.4.4 The Sound Tags</h3>
<p>The <code>&lt;sounds&gt;</code> tag lets you specify the path to the sound folder. It is followed by a list of <code>&lt;sound&gt;</code> tags, one for each sound effect in the game including the background image, and is closed by a <code>&lt;/sound&gt;</code> tag. Each <code>&lt;sound&gt;</code> tag has a <code>name</code> field, a <code>file</code> field, and an <code>instances</code> field. The <code>name</code> field contains a string that will identify the sound in the game's C++ code, and must be consistent with that code. The <code>file</code> field contains the name of the sound file and may be changed without the need to recompile the game should you decide to rename the file. The <code>name</code> field and the <code>file</code> field for any given sound may be completely different, should you feel the need to do so. The <code>instances</code> field specifies how many instances of a sound can be played simultaneously. The larger this number is, the more sound memory must be used. It is typically between 1 and 8. The <code>&lt;sound&gt;</code> tags may appear in any order inside the <code>&lt;sounds&gt;</code> and <code>&lt;/sounds&gt;</code> tags.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">sounds</span> <span class="keyword">path</span>=<span class="stringliteral">&quot;Media\Sounds&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">sound</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;clang&quot;</span> <span class="keyword">file</span>=<span class="stringliteral">&quot;clang.wav&quot;</span> <span class="keyword">instances</span>=<span class="stringliteral">&quot;8&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">sound</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;grunt&quot;</span> <span class="keyword">file</span>=<span class="stringliteral">&quot;umph.wav&quot;</span> <span class="keyword">instances</span>=<span class="stringliteral">&quot;8&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sounds</span>&gt;</div>
</div><!-- fragment --><p><a class="anchor" id="section5"></a></p><h1>5. Code Breakdown</h1>
<p>Open <code>Blank Game.sln</code> in Visual Studio and examine the code in the editor while you read the rest of this section, which is divided into two subsections. <a class="el" href="index.html#section5-1">Section 5.1</a> breaks down the code in <code><a class="el" href="_main_8cpp.html" title="The home of WinMain.">Main.cpp</a></code>. <a class="el" href="index.html#section5-2">Section 5.2</a> breaks down the code for <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code>, the object-oriented game code.</p>
<p><a class="anchor" id="section5-1"></a></p><h2>5.1 <a class="el" href="_main_8cpp.html" title="The home of WinMain.">Main.cpp</a></h2>
<p><code><a class="el" href="_main_8cpp.html" title="The home of WinMain.">Main.cpp</a></code> should be identical in all SAGE games except for commenting in and out a single line of code to activate the optional debug console (see <a class="el" href="index.html#section5-1-1">Section 5.1.1</a>) and memory leak detector (see <a class="el" href="index.html#section5-1-2">Section 5.1.2</a>). Function <code><a class="el" href="_main_8cpp.html#a4e25c396385b9a412e9e4c1010076520" title="The main entry point for this application.">wWinMain()</a></code> sets things up so that your implementation of <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize()</a></code> is called at the correct time during initialization, <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> is called as often as possible to compose and render a frame of animation, and <code><a class="el" href="class_c_game.html#aa4cbb6823e28b0b35cd4cac5f17ac797" title="Release the renderer.">CGame::Release()</a></code> is called at the correct time during game shutdown. <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> will be discussed in more detail in <a class="el" href="index.html#section5-2">Section 5.2</a>. The heavy lifting here is done by calling <a href="../sage/class_sage_1_1_c_window.html#adfe2944a5e50b1df557bb0babbc5eb9c"><code>Sage::WinMain</code></a> where you can see the details of Windows code initialization including the message pump. At this stage you can safely ignore these details, however.</p>
<p><a class="anchor" id="section5-1-1"></a></p><h3>5.1.1 The Debug Console</h3>
<p>SAGE includes an optional text debug window that can be used in both <code>Debug</code> and <code>Release</code> modes. If the line:</p>
<div class="fragment"><div class="line"><span class="comment">//#define USE_DEBUG_CONSOLE</span></div>
</div><!-- fragment --><p>in <code><a class="el" href="_main_8cpp.html" title="The home of WinMain.">Main.cpp</a></code> is uncommented as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define USE_DEBUG_CONSOLE</span></div>
</div><!-- fragment --><p>then a debug console window will appear at the same time as the game window. All text output to <code>stdout</code> using, for example, <code>printf</code> or <code>iostream</code> will appear in this window. For example, the line:</p>
<div class="fragment"><div class="line">printf(<span class="stringliteral">&quot;This is a test debug output\n&quot;</span>);</div>
</div><!-- fragment --><p>or the line:</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;This is a test debug output&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>inserted into a function such as <code><a class="el" href="class_c_game.html#a7c1fa6038d453a578371caa9f01e2388" title="Load sprites.">CGame::LoadSprites()</a></code> will result in the output shown in the debug console in <a class="el" href="index.html#fig4">Fig. 4</a>. Your debug text will be in red and directions will be in green text.</p>
<p><a class="anchor" id="fig4"></a></p><div class="image">
<img src="debugconsole.png" alt="" width="50%"/>
<div class="caption">
Fig. 4: The debug console.</div></div>
<p>The debug console window will persist after you quit your game in order to preserve debug output. Click on it to gain focus and press, for example, the space key to close it down as shown in <a class="el" href="index.html#fig5">Fig. 5</a></p>
<p><a class="anchor" id="fig5"></a></p><div class="image">
<img src="debugconsole2.png" alt="" width="50%"/>
<div class="caption">
Fig. 5: The debug console at exit.</div></div>
<p>The <code>#define</code> for the debug console is commented out by default, which means that the console window will not appear and all text output will go to <code>/dev/null</code>.</p>
<p><a class="anchor" id="section5-1-2"></a></p><h3>5.1.2 Visual Leak Detector</h3>
<p>If you choose to not install Visual Leak Detector (see <a class="el" href="index.html#section4">Section 4</a>), then comment out the following line:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;vld.h&gt;</span> </div>
</div><!-- fragment --><p><a class="anchor" id="section5-2"></a></p><h2>5.2 <a class="el" href="class_c_common.html" title="The common variables class.">CCommon</a></h2>
<p><code><a class="el" href="class_c_common.html" title="The common variables class.">CCommon</a></code> is an Accessor (see <a href="../sage/index.html#sec2-2">SAGE Data Design Patterns</a>) that contains variables that need to be shared between various classes. Its declaration is in <code><a class="el" href="_common_8h.html" title="Interface for the comon variables class CCommon.">Common.h</a></code> and its definition is in <code><a class="el" href="_common_8cpp.html" title="Code for the comon variables class CCommon.">Common.cpp</a></code>. We use it to avoid using global variables (which are discouraged in object-oriented programming) and to avoid cluttering up the parameter lists of functions that need to access them. In the Blank Game, <code><a class="el" href="class_c_common.html" title="The common variables class.">CCommon</a></code> consists of a single static member variable, a pointer to a renderer <code><a class="el" href="class_c_common.html#affe2697f28fbe937757db5eaa94c00d3" title="Pointer to renderer.">CCommon::m_pRenderer</a></code>, which is initialized to <code>nullptr</code>.</p>
<p><a class="anchor" id="section5-3"></a></p><h2>5.3 <a class="el" href="class_c_object.html" title="The game object.">CObject</a></h2>
<p><code><a class="el" href="class_c_object.html" title="The game object.">CObject</a> is the abstract representation of a game object. Its declaration is in</code><a class="el" href="_object_8h.html" title="Interface for object class CObject.">Object.h</a><code>and its definition is in</code>Object.cpp`. See <a href="class_c_object.html#details">CObject More Details</a> for more details.</p>
<p><a class="anchor" id="section5-4"></a></p><h2>5.4 <a class="el" href="class_c_game.html" title="The game class.">CGame</a></h2>
<p><code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> is the object-oriented representation of your game. Its declaration is in <code><a class="el" href="_game_8h.html" title="Interface for the game class CGame.">Game.h</a></code> and its definition is in <code><a class="el" href="_game_8cpp.html" title="Code for the game class CGame.">Game.cpp</a></code>. In addition, there are some useful defines and enumerated types in <code><a class="el" href="_game_defines_8h.html" title="Game specific defines and enumerated types.">GameDefines.h</a></code>.</p>
<p><a class="anchor" id="section5-4-1"></a></p><h3>5.4.1 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Initialization</h3>
<p>As mentioned in <a class="el" href="index.html#section5-1">Section 5.1</a>, <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize()</a></code> contains initialization code and will be called once only when your game starts. It creates a DirectXTK12 renderer (an instance of <a href="../sage/class_sage_1_1_c_sprite_renderer.html"><code>Sage::CSpriteRenderer</code></a>) pointed to by <code><a class="el" href="class_c_common.html#affe2697f28fbe937757db5eaa94c00d3" title="Pointer to renderer.">CCommon::m_pRenderer</a></code>. The parameter <code>Sage::eSpriteMode::Batched2D</code> to the sprite renderer directs it to use batched mode sprite renderer from DirectXTK12. It then creates an instance of <code>Sage::CObjectManager&lt;<a class="el" href="class_c_object.html" title="The game object.">CObject</a>&gt;</code> to manage the game objects (see <a class="el" href="index.html#section5-3">Section 5.3)</a>and saves a pointer to it in member variable <code><a class="el" href="class_c_game.html#a7848d55c076f86860849d948b26b174d" title="Object manager.">CGame::m_pObjectManager</a></code>. Finally, it calls <code><a class="el" href="class_c_game.html#a7c1fa6038d453a578371caa9f01e2388" title="Load sprites.">CGame::LoadSprites()</a></code> (see <a class="el" href="index.html#section5-4-2">Section 5.4.2</a>) to load the game sprites and <code><a class="el" href="class_c_game.html#a2b8445af848995e021ae59ae2e12be2c" title="Load sounds.">CGame::LoadSounds()</a></code> (see <a class="el" href="index.html#section5-4-3">Section 5.4.3</a>) to load the game sounds.</p>
<p><a class="anchor" id="section5-4-2"></a></p><h3>5.4.2 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Loading Sprites</h3>
<p><code><a class="el" href="class_c_game.html#a7c1fa6038d453a578371caa9f01e2388" title="Load sprites.">CGame::LoadSprites()</a></code> loads sprites for the background and the text wheel. For convenience, the following enumerated type is declared in <code><a class="el" href="_game_defines_8h.html" title="Game specific defines and enumerated types.">GameDefines.h</a></code>.</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> <a class="code hl_enumeration" href="_game_defines_8h.html#ae419e2bc55ebc731cfdbf4ab769f44e4">eSprite</a>{</div>
<div class="line">  Background, TextWheel</div>
<div class="line">}; <span class="comment">//eSprite</span></div>
<div class="ttc" id="a_game_defines_8h_html_ae419e2bc55ebc731cfdbf4ab769f44e4"><div class="ttname"><a href="_game_defines_8h.html#ae419e2bc55ebc731cfdbf4ab769f44e4">eSprite</a></div><div class="ttdeci">eSprite</div><div class="ttdoc">Sprite enumerated type.</div><div class="ttdef"><b>Definition</b> GameDefines.h:30</div></div>
</div><!-- fragment --><p>These will be used to refer to the sprites in the source code. <code><a class="el" href="class_c_game.html#a7c1fa6038d453a578371caa9f01e2388" title="Load sprites.">CGame::LoadSprites()</a></code> first declares a <a href="../sage/class_sage_1_1_c_media_list.html"><code>Sage::CMediaList</code></a> of type <code>eSprite</code>.</p>
<div class="fragment"><div class="line">Sage::CMediaList&lt;eSprite&gt; media;</div>
</div><!-- fragment --><p>It then inserts information about the two game sprites into this media list.</p>
<div class="fragment"><div class="line">media.Insert(eSprite::Background, <span class="stringliteral">&quot;background&quot;</span>); </div>
<div class="line">media.Insert(eSprite::TextWheel,  <span class="stringliteral">&quot;textwheel&quot;</span>); </div>
</div><!-- fragment --><p>The first parameter is the <code>eSprite</code> entry for the sprite (its name within the source code) and a string (its name in <code>GameSettings.xml</code>). This string must be identical to the string in the <code>name</code> field of a <code>sprite</code> tag in <code>GameSettings.xml</code> (see <a class="el" href="index.html#section4-4-3">Section 4.4.3</a>). It then calls <a href="../sage/class_sage_1_1_c_sound.html#a50299d4b69d084660b473d4e54c34ee8"><code>Sage::CSound::LoadMT()</code></a> to load the sprites asynchronously in a separate thread. (Recall that <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> has a pointer to an instance of <a href="../sage/class_sage_1_1_c_sprite_renderer.html"><code>Sage::CSpriteRenderer</code></a> in member variable <code>m_pRenderer</code>, which it inherited from <code><a class="el" href="class_c_common.html" title="The common variables class.">CCommon</a></code>, see <a class="el" href="index.html#section5-2">Section 5.2</a>).</p>
<div class="fragment"><div class="line">m_pRenderer-&gt;LoadMT(media);</div>
</div><!-- fragment --><p><code><a class="el" href="class_c_game.html#a7c1fa6038d453a578371caa9f01e2388" title="Load sprites.">CGame::LoadSprites()</a></code> will exit immediately and computation will proceed while the sprites load. If you wish to load the sprites synchronously so that <code><a class="el" href="class_c_game.html#a7c1fa6038d453a578371caa9f01e2388" title="Load sprites.">CGame::LoadSprites()</a></code> returns only after the sprites have been loaded (for example, during debugging), use the following instead.</p>
<div class="fragment"><div class="line">m_pRenderer-&gt;Load(media);</div>
</div><!-- fragment --><p><a class="anchor" id="section5-4-3"></a></p><h3>5.4.3 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Loading Sounds</h3>
<p><code><a class="el" href="class_c_game.html#a2b8445af848995e021ae59ae2e12be2c" title="Load sounds.">CGame::LoadSounds()</a></code> loads sounds. For convenience, the following enumerated type is declared in <code><a class="el" href="_game_defines_8h.html" title="Game specific defines and enumerated types.">GameDefines.h</a></code>.</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> <a class="code hl_enumeration" href="_game_defines_8h.html#a05551407c3195664c546b61dea02e822">eSound</a>{</div>
<div class="line">  Clang, Grunt</div>
<div class="line">}; <span class="comment">//eSound</span></div>
<div class="ttc" id="a_game_defines_8h_html_a05551407c3195664c546b61dea02e822"><div class="ttname"><a href="_game_defines_8h.html#a05551407c3195664c546b61dea02e822">eSound</a></div><div class="ttdeci">eSound</div><div class="ttdoc">Sound enumerated type.</div><div class="ttdef"><b>Definition</b> GameDefines.h:39</div></div>
</div><!-- fragment --><p>These will be used to refer to the sounds in the source code. <code><a class="el" href="class_c_game.html#a2b8445af848995e021ae59ae2e12be2c" title="Load sounds.">CGame::LoadSounds()</a></code> first declares a <a href="../sage/class_sage_1_1_c_media_list.html"><code>Sage::CMediaList</code></a> of type <code>eSound</code>.</p>
<div class="fragment"><div class="line">Sage::CMediaList&lt;eSound&gt; media;</div>
</div><!-- fragment --><p>It then inserts information about the two game sounds into this media list.</p>
<div class="fragment"><div class="line">media.Insert(eSound::Grunt, <span class="stringliteral">&quot;grunt&quot;</span>);</div>
<div class="line">media.Insert(eSound::Clang, <span class="stringliteral">&quot;clang&quot;</span>); </div>
</div><!-- fragment --><p>The first parameter is the <code>eSound</code> entry for the sound (its name within the source code) and a string (its name in <code>GameSettings.xml</code>). This string must be identical to the string in the <code>name</code> field of a <code>sound</code> tag in <code>GameSettings.xml</code> (see <a class="el" href="index.html#section4-4-4">Section 4.4.4</a>). It then calls <a href="../sage/class_sage_1_1_c_sound.html#a50299d4b69d084660b473d4e54c34ee8"><code>Sage::CSound::LoadMT()</code></a> to load the sounds asynchronously in a separate thread. <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> inherits a pointer <code>m_pSound</code> to an instance of <a href="../sage/class_sage_1_1_c_sound.html"><code>Sage::CSound</code></a> from <a href="../sage/class_sage_1_1_c_component.html"><code>Sage::CComponent</code></a>.</p>
<div class="fragment"><div class="line">m_pSound-&gt;LoadMT(media);</div>
</div><!-- fragment --><p><code><a class="el" href="class_c_game.html#a2b8445af848995e021ae59ae2e12be2c" title="Load sounds.">CGame::LoadSounds()</a></code> will exit immediately and computation will proceed while the sounds load. If you wish to load the sounds synchronously so that <code><a class="el" href="class_c_game.html#a2b8445af848995e021ae59ae2e12be2c" title="Load sounds.">CGame::LoadSounds()</a></code> returns only after the sounds have been loaded (for example, during debugging), use the following instead.</p>
<div class="fragment"><div class="line">m_pSound-&gt;Load(media);</div>
</div><!-- fragment --><p><a class="anchor" id="section5-4-4"></a></p><h3>5.4.4 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: The Frame Loop</h3>
<p>As mentioned in <a class="el" href="index.html#section5-1">Section 5.1</a>, <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> contains code that creates and displays the next frame of animation. SAGE will ensure that this function will be called repeatedly in a loop that terminates only when the game exits.</p>
<p><a class="anchor" id="section5-4-4-1"></a></p><h4>5.4.4.1 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Frame Loop: The Game State</h4>
<p>The behavior of <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> will depend on the current state of the game, which is recorded in <code><a class="el" href="class_c_game.html#a6d6d7b949d4a47b7c5d03c9dbf4be6fd" title="Game state.">CGame::m_eGameState</a></code>, which is of type <code>eGameState</code>, declared in <code><a class="el" href="_game_defines_8h.html" title="Game specific defines and enumerated types.">GameDefines.h</a></code> as:</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> <a class="code hl_enumeration" href="_game_defines_8h.html#ae12dcfc1b1e01980b11e116e3af6807f">eGameState</a>{</div>
<div class="line">  Loading, Playing</div>
<div class="line">}; <span class="comment">//eGameState</span></div>
<div class="ttc" id="a_game_defines_8h_html_ae12dcfc1b1e01980b11e116e3af6807f"><div class="ttname"><a href="_game_defines_8h.html#ae12dcfc1b1e01980b11e116e3af6807f">eGameState</a></div><div class="ttdeci">eGameState</div><div class="ttdoc">Game state enumerated type.</div><div class="ttdef"><b>Definition</b> GameDefines.h:13</div></div>
</div><!-- fragment --><p><code><a class="el" href="class_c_game.html#a6d6d7b949d4a47b7c5d03c9dbf4be6fd" title="Game state.">CGame::m_eGameState</a></code> is initially set to <code>eGameState::Loading</code> and we will change it to <code>eGameState::Playing</code> when the (possibly asynchronous) loading of sprites and sounds is finished.</p>
<p><a class="anchor" id="section5-4-4-2"></a></p><h4>5.4.4.2 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Frame Loop: The Keyboard Handler</h4>
<p>The first thing that <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> does is call the keyboard handler <code><a class="el" href="class_c_game.html#a74a75ef02b07f0f785de8aa6e7631b5d" title="The keyboard handler.">CGame::KeyboardHandler()</a></code>. <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> inherits from <a href="../sage/class_sage_1_1_c_component.html"><code>Sage::CComponent</code></a> a pointer <code>m_pKeyboard</code> to an instance of <a href="../sage/class_sage_1_1_c_keyboard.html"><code>Sage::CKeyboard</code></a> which provides functions to poll the current state of a key on the keyboard. <code><a class="el" href="class_c_game.html#a74a75ef02b07f0f785de8aa6e7631b5d" title="The keyboard handler.">CGame::KeyboardHandler()</a></code> first calls:</p>
<div class="fragment"><div class="line">m_pKeyboard-&gt;GetState(); </div>
</div><!-- fragment --><p>Then, for example, a call to:</p>
<div class="fragment"><div class="line">m_pKeyboard-&gt;TriggerDown(VK_F1) </div>
</div><!-- fragment --><p>will return <code>true</code> if the <code>F1</code> function key was up and went down during the current frame. The keys are identified using <a href="https://learn.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes">virtual-key codes</a>. An often-missed observation is that the virtual key code for alphanumerics is the corresponding upper-case character, so for example, the virtual-key code for the letter A is not <code>VK_A</code>, it is 'A' and can be used as follows:</p>
<div class="fragment"><div class="line">m_pKeyboard-&gt;TriggerDown(<span class="charliteral">&#39;A&#39;</span>) </div>
</div><!-- fragment --><p><a class="anchor" id="section5-4-4-3"></a></p><h4>5.4.4.3 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Frame Loop: Motion</h4>
<p>If the current game state is not <code>eGameState::Loading</code> (see <a class="el" href="index.html#section5-4-4-1">Section 5.4.4.1</a>) then <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> does the following. <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> inherits from <a href="../sage/class_sage_1_1_c_component.html"><code>Sage::CComponent</code></a> a pointer <code>m_pSound</code> to an instance of <a href="../sage/class_sage_1_1_c_sound.html"><code>Sage::CSound</code></a>, which provides functions to play and mix sounds asynchronously. Function <a href="../sage/class_sage_1_1_c_sound.html#acce2cf44671cf243cd1670853941d4c2"><code>Sage::CSound::BeginFrame()</code></a> is then called to notify the sound player that a new animation frame has begun.</p>
<div class="fragment"><div class="line">m_pSound-&gt;BeginFrame();</div>
</div><!-- fragment --><p>This is used internally to SAGE to prevent any sound being started twice (or more) in any given frame - which would result in the sound being played at twice (or more) the volume.</p>
<p><code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> also inherits from <a href="../sage/class_sage_1_1_c_component.html"><code>Sage::CComponent</code></a> a pointer <code>m_pTimer</code> to an instance of <a href="../sage/class_sage_1_1_c_timer.html"><code>Sage::CTimer</code></a>, which provides functions to accurately measure time. The motion of all game objects should be proportional to frame time, otherwise things would move faster on a 60Hz monitor than on a 30Hz monitor. References to the timer should be inside a <a href="../sage/class_sage_1_1_c_timer.html#ab24d65d62c636f7b2a09d30380cc4ef0"><code>Sage::CTimer::Tick()</code></a> functor as follows:</p>
<div class="fragment"><div class="line">m_pTimer-&gt;Tick([&amp;](){</div>
<div class="line">  <span class="comment">//time dependent code goes here</span></div>
<div class="line">});</div>
</div><!-- fragment --><p>We want to rotate the text wheel sprite by an angle proportional to the frame time. The frame time is obtained by calling:</p>
<div class="fragment"><div class="line">m_pTimer-&gt;GetFrameTime()</div>
</div><!-- fragment --><p>which returns the frame time in seconds as a <code>float</code>.</p>
<p><code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> has a member variable <code>m_pSpriteDesc</code> which will point to a sprite descriptor <a href="../sage/class_sage_1_1_c_sprite_desc2_d.html"><code>Sage::CSpriteDesc2D</code></a> that records properties of the sprite such as its screen coordinates and angle of orientation. Its orientation is stored in <code>m_pSpriteDesc-&gt;m_fRoll</code> in radians. <code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> does the following once per frame:</p>
<div class="fragment"><div class="line">m_pSpriteDesc-&gt;m_fRoll += 0.125f*XM_2PI*m_pTimer-&gt;GetFrameTime();</div>
</div><!-- fragment --><p>The <code>0.125f</code> multiplier ensures that the text wheel rotates once every 8 seconds.</p>
<p><a class="anchor" id="section5-4-4-4"></a></p><h4>5.4.4.4 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Frame Loop: Rendering</h4>
<p><code><a class="el" href="class_c_game.html#aec83638cb2fdd94ef098132eb59617d8" title="Process an animation frame.">CGame::ProcessFrame()</a></code> then renders an animation frame by calling <code><a class="el" href="class_c_game.html#a8b7924e5be62a511e2fc90cc40b7cbb0" title="Render an animation frame.">CGame::RenderFrame()</a></code>. All rendering must be done between calls to <a href="../sage/class_sage_1_1_c_sprite_renderer.html#aa9fdd8301a51b7e7c853ed4a1649ac5e"><code>Sage::CSpriteRenderer::BeginFrame()</code></a> and <a href="../sage/class_sage_1_1_c_sprite_renderer.html#a16dbd29c51dc0384d186b39671d8f5d8"><code>Sage::CSpriteRenderer::EndFrame()</code></a>). (Recall that <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> has a pointer to an instance of <a href="../sage/class_sage_1_1_c_sprite_renderer.html"><code>Sage::CSpriteRenderer</code></a> in member variable <code>m_pRenderer</code>, which it inherited from <code><a class="el" href="class_c_common.html" title="The common variables class.">CCommon</a></code>, see <a class="el" href="index.html#section5-2">Section 5.2</a>).</p>
<p>If the game has finished loading sounds and sprites, that is, if <code>m_eGameState</code> is not <code>eGameState::Loading</code>, then we draw an animation frame by first drawing the background with a call to:</p>
<div class="fragment"><div class="line">m_pRenderer-&gt;Draw(eSprite::Background, m_vWinCenter);</div>
</div><!-- fragment --><p>Note that <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> inherits <code>m_vWinCenter</code>, a 2D vector <code>Vector2</code> containing the position of the center of the user rectangle in the game window from <a href="../sage/class_sage_1_1_c_settings.html"><code>Sage::CSettings</code></a>. We then draw the text wheel sprite at its current orientation using:</p>
<div class="fragment"><div class="line">m_pRenderer-&gt;Draw(m_pSpriteDesc);</div>
</div><!-- fragment --><p>Since the background is drawn first, the text wheel will be drawn on top of it (transparent pixels in the text wheel are omitted, naturally). (Recall from <a class="el" href="index.html#section5-4-1">Section 5.4.1</a> that our instance of <a href="../sage/class_sage_1_1_c_sprite_renderer.html"><code>Sage::CSpriteRenderer</code></a> uses batched mode sprite rendering from DirectXTK12). This method of rendering from back to front is called <em>painter's algorithm</em>.</p>
<p>On the other hand, if the game is still loading sounds and sprites, that is, if <code>m_eGameState</code> is <code>eGameState::Loading</code>, then we draw the text <code>Loading...</code> at the center of the window using <code>Sage::CSpriteRenderer::DrawCenteredText()</code>:</p>
<div class="fragment"><div class="line">m_pRenderer-&gt;DrawCenteredText(L<span class="stringliteral">&quot;Loading...&quot;</span>);</div>
</div><!-- fragment --><p>You probably won't see this text in the Blank Game, or you might see it for a fraction of a second, but you will see it on SAGE games that have many more, and/or much larger sprites and sounds, particularly if you don't have a solid state hard drive.</p>
<p>Finally, if the <code><a class="el" href="class_c_game.html" title="The game class.">CGame</a></code> member variable <code>m_bDrawFrameRate</code> is set to <code>true</code>, which happens in <code><a class="el" href="class_c_game.html#a74a75ef02b07f0f785de8aa6e7631b5d" title="The keyboard handler.">CGame::KeyboardHandler()</a></code> in response to the F2 key, then <code><a class="el" href="class_c_game.html#ad2ae857e236f8748ccd71b0e2354938c" title="Draw frame rate text to screen.">CGame::DrawFrameRateText()</a></code> is called to draw the frame rate obtained from <code>m_pTimer-&gt;GetFPS()</code> at the top right of the screen.</p>
<p><a class="anchor" id="section5-4-4-5"></a></p><h4>5.4.4.5 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Frame Loop: Process Game State</h4>
<p><code><a class="el" href="class_c_game.html#a4348d4eda6cc858625e8cac09dcc1e7d" title="Process game state.">CGame::ProcessState()</a></code> processes any changes to the game state that occurred in the current frame. In the Blank Game this is very simple. If <code>m_eGameState</code> is <code>eGameState::Loading</code>, we query the renderer and the sound player to see whether they have finished loading, that is, <code>m_pRenderer-&gt;Loaded()</code> returns <code>true</code> and <code>m_pSound-&gt;Loaded()</code> returns <code>true</code>. If so, we call <code><a class="el" href="class_c_game.html#af7200bd66587e10002e7ed9e4a1f930e" title="Begin playing the game.">CGame::BeginGame()</a></code>, which sets <code>m_eGameState</code> to <code>eGameState::Playing</code>, clears any old objects from the object manager, and creates an instance of <code>CSprite</code> for the text wheel at the center of the screen and inserts it into the object manager.</p>
<p>Note that <code><a class="el" href="class_c_game.html#af7200bd66587e10002e7ed9e4a1f930e" title="Begin playing the game.">CGame::BeginGame()</a></code> is also called from <code><a class="el" href="class_c_game.html#a74a75ef02b07f0f785de8aa6e7631b5d" title="The keyboard handler.">CGame::KeyboardHandler()</a></code> in response to the <code>Backspace</code> key. Care must be taken here to avoid memory leaks and crashes in your own game. Recall that Visual Leak Detector (see <a class="el" href="index.html#section4">Section 4</a>) can be used in Debug mode to detect memory leaks.</p>
<p><a class="anchor" id="section5-2-5"></a></p><h3>5.2.5 <a class="el" href="class_c_game.html" title="The game class.">CGame</a>: Shutting Down</h3>
<p>As mentioned in <a class="el" href="index.html#section5-1">Section 5.1</a>, <code><a class="el" href="class_c_game.html#aa4cbb6823e28b0b35cd4cac5f17ac797" title="Release the renderer.">CGame::Release()</a></code> contains shutdown code and will be called once only when your game shuts down. All it needs to do is delete the instance of <a href="../sage/class_sage_1_1_c_sprite_renderer.html"><code>Sage::CSpriteRenderer</code></a>), which takes care of the details of shutting down DirectX 12. It is important that this gets done before the destructor <code><a class="el" href="class_c_game.html#a4db10c09035dc16b32d6c1ef4cca2143" title="Destructor.">CGame::~CGame()</a></code> is called.</p>
<p><a class="anchor" id="section6"></a></p><h1>6. What Next?</h1>
<p>What's next are some <a href="../introgames/index.html">more games</a> and some <a href="../introphysics/index.html">physics games and toys</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
