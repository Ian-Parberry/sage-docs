<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bullet Physics Block Toy: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="sagedoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Bullet Physics Block Toy
   </div>
   <div id="projectbrief">Game Physics with a 3D Physics Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="contents">
<div class="textblock"><p><a class="anchor" id="section1"></a></p><h1>1. Introduction</h1>
<p><a class="anchor" id="fig1"></a></p><div class="image">
<img src="all.gif" alt="" width="60%"/>
<div class="caption">
Fig. 1: Screen shots of various objects.</div></div>
<p>A simple 3D toy using <a href="https://pybullet.org/wordpress/">Bullet Physics</a> consisting of various things (see <a class="el" href="#fig1">Fig. 1</a>) that you can knock over by throwing soccer balls at them. The remainder of this page is divided into five sections. <a class="el" href="#section2">Section 2</a> lists the controls and their corresponding actions, <a class="el" href="#section3">Section 3</a> tells you how to build it, <a class="el" href="#section4">Section 4</a> gives you a list of actions to take in the game to see some of its important features, <a class="el" href="#section5">Section 5</a> gives a breakdown of the code, and <a class="el" href="#section6">Section 6</a> addresses the question "what next?".</p>
<p><a class="anchor" id="section2"></a></p><h1>2. Keyboard Controls</h1>
<p>This toy can be played with either the keyboard or an XBOX controller.</p>
<center> <table class="doxtable">
<tr>
<td><center><b>Keyboard</b></center> </td><td><center><b>Controller</b></center> </td><td><center><b>Action</b></center> </td></tr>
<tr>
<td><center>F1</center> </td><td><center>-</center> </td><td>Help (this document) </td></tr>
<tr>
<td><center>Space</center> </td><td><center>Right button</center> </td><td>Throw a ball along the view vector. </td></tr>
<tr>
<td><center>Arrow keys</center> </td><td><center>Right stick</center> </td><td>Camera orientation. </td></tr>
<tr>
<td><center>WASD</center> </td><td><center>Dpad</center> </td><td>Camera motion (relative to the view vector). </td></tr>
<tr>
<td><center>Backspace</center> </td><td><center>A</center> </td><td>Reset to initial conditions. </td></tr>
<tr>
<td><center>PrtScr (hold down)</center> </td><td><center>-</center> </td><td>Save screenshot to a PNG file </td></tr>
<tr>
<td><center>Esc</center> </td><td><center>-</center> </td><td>Quit game and close the window </td></tr>
</table>
</center><p><a class="anchor" id="section3"></a></p><h1>3. Building the Game</h1>
<p>This code uses <a href="../sage/index.html">SAGE</a> and <a href="https://pybullet.org/wordpress/">Bullet Physics</a>. Make sure that you have followed the <a href="../install/index.html">SAGE Installation Instructions</a> and the <a href="../installphysics/index.html">Bullet Physics Installation Instructions</a>. Navigate to the folder <span style="background-color:#D8E4D8;"><code>15. Bullet Physics Block Toy</code></span> in your copy of the <span style="background-color:#D8E4D8;"><code>sage-physics</code></span> repository. Run <span style="background-color:#D8E4D8;"><code>checkenv.bat</code></span> to verify that you have set the environment variables correctly. Open <span style="background-color:#D8E4D8;"><code>Bullet Physics Block Toy.sln</code></span> with Visual Studio and build the Release configuration. Alternatively, run <span style="background-color:#D8E4D8;"><code>Build.bat</code></span> to build both Release and Debug configurations.</p>
<p><a class="anchor" id="section4"></a></p><h1>4. Game Play</h1>
<p><a class="anchor" id="fig2"></a></p><div class="image">
<img src="fallen.png" alt="" width="60%"/>
<div class="caption">
Fig. 2: Knock over the stack of boxes.</div></div>
<p>Navigate around the world using the controls in <a class="el" href="#section2">Section 2</a> and launch soccer balls to knock down the pile of of creates as shown in <a class="el" href="#fig2">Fig. 2</a>. With enough patience and perseverance you can push everything in in <a class="el" href="#fig1">Fig. 1</a> off the edge of the world.</p>
<p><a class="anchor" id="section5"></a></p><h1>5. Code Breakdown</h1>
<p>Shapes and models are rendered using <code>DirectX::GeometricPrimitive</code> and <code>DirectX::Model</code>. The latter is loaded using function <code>Model::CreateFromSDKMESH</code> which requires that the models be in SDKMESH format. The 3D models are from <a href="https://free3d.com/">free3d.com</a> and were converted from OBJ format using <code>DirectXMesh</code>. Collision detection and response is handled by <a href="https://pybullet.org/wordpress/">Bullet Physics</a>.</p>
<p><code>DirectX::GeometricPrimitive</code> requires the use of <a href="https://en.wikipedia.org/wiki/Quaternion">quaternions</a> to specify orientation, more specifically <code>DirectX::SimpleMath::Quaternion</code>. Bullet Physics uses <code>btQuaternion</code>. We provide a method for casting instance of <code>DirectX::SimpleMath::Quaternion</code> to an instance of <code>btQuaternion</code> as a version of <code>RW2PW</code> in <span style="background-color:#D8E4D8;"><code><a class="el" href="_game_defines_8h.html" title="Game specific defines.">GameDefines.h</a></code></span>, and the reverse as an instance of <code>PW2RW</code>.</p>
<p><a class="anchor" id="section5-1"></a></p><h2>5.1 Shapes</h2>
<p>The game world contains a few convex polygons from DirectXTK12's <code>GeometricPrimitive</code>. These polygons consist of a list of vertices and a list of edges joining them to form a triangle mesh. The <em>circumradius</em> of a convex polygon mesh is the radius of the sphere that passes through all vertices. The <em>inradius</em> of a convex polygon mesh is the radius of the largest sphere that can fit inside the polygon. This is the height of the center of the polygon when one face rests on the ground.</p>
<p><a class="anchor" id="section5-1-1"></a></p><h3>5.1.1 The Regular Tetrahedron</h3>
<p>The tetrahedron object is an instance of <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code> created in <code><a class="el" href="class_c_object_manager.html#a47c6139224ca0bc1b7aae523e90534c3" title="Create an object.">CObjectManager::Create</a></code>, which takes as a parameter an instance descriptor <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code>. <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code> has useful parameters for the object instance to be created including its orientation <code><a class="el" href="class_c_instance_desc.html#a81f466877c38d26ce68ded644376ac80" title="Orientation.">CInstanceDesc::m_qOrientation</a></code> and scale <code><a class="el" href="class_c_instance_desc.html#a9320b40fceb0fc0fa02669bd234e729d" title="Scale.">CInstanceDesc::m_fScale</a></code>.</p>
<p>The tetrahedron mesh is created in <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> by calling <code>DirectX::GeometricPrimitive::CreateTetrahedron</code>. <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> is called from <code><a class="el" href="class_c_renderer.html#a38d5e7055814cac465c9a55bf07415ec" title="Load meshes.">CRenderer::LoadGeometricPrimitives</a></code>, which is called from <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code>. The default polygon mesh created by <code>DirectX::GeometricPrimitive::CreateTetrahedron</code> has circumradius 1. The Cartesian coordinates of the vertices of a regular tetrahedron of circumradius 1 are      </p><p class="formulaDsp">
\[
(-\sqrt{2}/3, \sqrt{2}/\sqrt{3}, -1/3)\\
(2\sqrt{2}/3, 0, -1/3)\\
(-\sqrt{2}/3, -\sqrt{2}/\sqrt{3}, -1/3)\\
(0, 0, 1)
\]
</p>
<p> Its edge length is therefore \(2 \sqrt{2}/\sqrt{3}\). The inradius of a tetrahedron of edge length \(1\) is \(1/2\sqrt{6}\). The inradius of the tetrahedron created by <code>DirectX::GeometricPrimitive::CreateTetrahedron</code> is therefore \(2 \sqrt{2}/\sqrt{3}\) divided by \(2\sqrt{6}\), that is, \(1/3\).</p>
<p>We ask <code>DirectX::GeometricPrimitive::CreateTetrahedron</code> to create a polygon mesh of circumradius <code><a class="el" href="class_c_common.html#a21c879c4d0c625c547c239076530b9c2" title="Tetrahedron size.">CCommon::m_fTetrahedronSize</a></code>, which is a constant set to <code>16.0f</code>. This will have an inradius of <code><a class="el" href="class_c_common.html#a21c879c4d0c625c547c239076530b9c2" title="Tetrahedron size.">CCommon::m_fTetrahedronSize</a>/3</code>. Therefore the scale and vertical height of the tetrahedron object instance descriptor <code><a class="el" href="class_c_game.html#a6a5af1b87c696a23a626812b74c653ea" title="Create game objects.">CGame::CreateObjects</a></code> are <code>m_fTetrahedronSize</code> and <code>m_fTetrahedronSize/3.0f</code>, respectively.</p>
<p><a class="anchor" id="fig3"></a></p><div class="image">
<img src="tetrahedron.png" alt="" width="40%"/>
<div class="caption">
Fig. 3: The tetrahedron in its initial orientation.</div></div>
<p>The tetrahedron mesh created by <code>DirectX::GeometricPrimitive::CreateTetrahedron</code> has default orientation is shown in <a class="el" href="#fig3">Fig. 3</a>, whereas we want its initial orientation to be with one face flat on the ground as shown in the appropriate frame of <a class="el" href="#fig1">Fig. 1</a>. This can be fixed by rotating it by \(\pi/2\) around its X-axis. We also rotate it \(\pi\) around the Y-axis so that an edge faces the camera. Therefore the <code>m_qOrientation</code> field of the instance descriptor used to create the tetrahedron object in <code><a class="el" href="class_c_game.html#a6a5af1b87c696a23a626812b74c653ea" title="Create game objects.">CGame::CreateObjects</a></code> is <code>DirectX::SimpleMath::Quaternion::CreateFromYawPitchRoll(XM_PI, -XM_PIDIV2, 0)</code>.</p>
<p><a class="anchor" id="section5-1-2"></a></p><h3>5.1.2 The Regular Dodecahedron</h3>
<p>The dodecahedron object is an instance of <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code> created in <code><a class="el" href="class_c_object_manager.html#a47c6139224ca0bc1b7aae523e90534c3" title="Create an object.">CObjectManager::Create</a></code>, which takes as a parameter an instance descriptor <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code>. <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code> has useful parameters for the object instance to be created including its orientation <code><a class="el" href="class_c_instance_desc.html#a81f466877c38d26ce68ded644376ac80" title="Orientation.">CInstanceDesc::m_qOrientation</a></code> and scale <code><a class="el" href="class_c_instance_desc.html#a9320b40fceb0fc0fa02669bd234e729d" title="Scale.">CInstanceDesc::m_fScale</a></code>.</p>
<p>The dodecahedron mesh is created in <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> by calling <code>DirectX::GeometricPrimitive::CreateDodecahedron</code>. <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> is called from <code><a class="el" href="class_c_renderer.html#a38d5e7055814cac465c9a55bf07415ec" title="Load meshes.">CRenderer::LoadGeometricPrimitives</a></code>, which is called from <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code>. The default polygon mesh created by <code>DirectX::GeometricPrimitive::CreateDodecahedron</code> has circumradius \(1\). The Cartesian coordinates of the vertices of a regular dodecahedron of circumradius \(\sqrt{3}\) are      </p><p class="formulaDsp">
\[
(0, \pm \phi, \pm 1/\phi)\\
(\pm 1, \pm 1, \pm 1)\\
(\pm 1/\phi, 0, \pm \phi)\\
(\pm \phi, \pm 1/\phi, 0)
\]
</p>
<p> where \(\phi = (\sqrt{5} + 1)/2\). Its edge length is \(2/\phi = \sqrt{5} - 1\). The Cartesian coordinates of the vertices of a regular dodecahedron of circumradius \(1\) can be obtained by multiplying these points by \(1/\sqrt{3}\). This will have edge length \((\sqrt{5} - 1)/\sqrt{3}\).</p>
<p>The inradius of a dodecahedron of edge length \(1\) is \(\sqrt{250+110\sqrt{5}}/40\). The inradius of the dodecahedron created by <code>DirectX::GeometricPrimitive::CreateDodecahedron</code> is therefore \(\sqrt{250+110\sqrt{5}}/40\) divided by \((\sqrt{5} - 1)/\sqrt{3}\), that is, \(\sqrt{750+330\sqrt{5}}/40(\sqrt{5}-1)\).</p>
<p>We ask <code>DirectX::GeometricPrimitive::CreateDodecahedron</code> to create a polygon mesh of circumradius <code><a class="el" href="class_c_common.html#af7cca6c928d0f1e2a2e276a38622109d" title="Dodecahedron size.">CCommon::m_fDodecahedronSize</a></code>, which is a constant set to <code>16.0f</code>. This will have an inradius of <code><a class="el" href="class_c_common.html#af7cca6c928d0f1e2a2e276a38622109d" title="Dodecahedron size.">CCommon::m_fDodecahedronSize</a>/3</code>. Therefore the scale and vertical height of the dodecahedron object instance descriptor <code><a class="el" href="class_c_game.html#a6a5af1b87c696a23a626812b74c653ea" title="Create game objects.">CGame::CreateObjects</a></code> are <code>m_fDodecahedronSize</code> and <code>m_fDodecahedronSize*sqrtf(750.0f + 330.0f*sqrtf(5))/(40.0f*(sqrtf(5) - 1.0f));</code>, respectively.</p>
<p><a class="anchor" id="fig4"></a></p><div class="image">
<img src="dodecahedron.png" alt="" width="40%"/>
<div class="caption">
Fig. 4: The dodecahedron in its initial orientation.</div></div>
<p>The dodecahedron mesh created by <code>DirectX::GeometricPrimitive::CreateDodecahedron</code> has default orientation is shown in <a class="el" href="#fig4">Fig. 4</a>, whereas we want its initial orientation to be with one face flat on the ground as shown in the appropriate frame of <a class="el" href="#fig1">Fig. 1</a>. This can be fixed by rotating it around its Z-axis by one half the <em>dihedral angle</em>, which is the angle between two adjacent faces. The dihedral angle of a regular dodecahedron is \(2 \arctan \phi = \pi - \arctan(2)\). Therefore the <code>m_qOrientation</code> field of the instance descriptor used to create the dodecahedron object in <code><a class="el" href="class_c_game.html#a6a5af1b87c696a23a626812b74c653ea" title="Create game objects.">CGame::CreateObjects</a></code> is <code>DirectX::SimpleMath::Quaternion::CreateFromAxisAngle(Vector3::UnitZ, (XM_PI - atanf(2.0f))/2.0f)</code>.</p>
<p><a class="anchor" id="section5-1-3"></a></p><h3>5.1.3 The Regular Icosahedron</h3>
<p>The icosahedron object is an instance of <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code> created in <code><a class="el" href="class_c_object_manager.html#a47c6139224ca0bc1b7aae523e90534c3" title="Create an object.">CObjectManager::Create</a></code>, which takes as a parameter an instance descriptor <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code>. <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code> has useful parameters for the object instance to be created including its orientation <code><a class="el" href="class_c_instance_desc.html#a81f466877c38d26ce68ded644376ac80" title="Orientation.">CInstanceDesc::m_qOrientation</a></code> and scale <code><a class="el" href="class_c_instance_desc.html#a9320b40fceb0fc0fa02669bd234e729d" title="Scale.">CInstanceDesc::m_fScale</a></code>.</p>
<p>The icosahedron mesh is created in <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> by calling <code>DirectX::GeometricPrimitive::CreateIcosahedron</code>. <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> is called from <code><a class="el" href="class_c_renderer.html#a38d5e7055814cac465c9a55bf07415ec" title="Load meshes.">CRenderer::LoadGeometricPrimitives</a></code>, which is called from <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code>. The default polygon mesh created by <code>DirectX::GeometricPrimitive::CreateIcosahedron</code> has circumradius \(1\). The Cartesian coordinates of the vertices of a regular icosahedron of circumradius \(\sqrt{\phi + 2}\) are      </p><p class="formulaDsp">
\[
(0, \pm 2, \pm \phi)\\
(\pm 1, \pm \phi, )\\
(\pm 1/\phi, 0, \pm \phi)\\
(\pm \phi, 0, \pm \phi)
\]
</p>
<p> where \(\phi = (\sqrt{5} + 1)/2\).</p>
<p>The inradius of the icosahedron created by <code>DirectX::GeometricPrimitive::CreateIcosahedron</code> is equal to \(1\). Therefore the scale and vertical height of the icosahedron object instance descriptor <code><a class="el" href="class_c_game.html#a6a5af1b87c696a23a626812b74c653ea" title="Create game objects.">CGame::CreateObjects</a></code> are both equal to <code>m_IcosahedronSize</code>.</p>
<p><a class="anchor" id="fig5"></a></p><div class="image">
<img src="icosahedron.png" alt="" width="40%"/>
<div class="caption">
Fig. 5: The icosahedron in its initial orientation.</div></div>
<p>The icosahedron mesh created by <code>DirectX::GeometricPrimitive::CreateIcosahedron</code> has default orientation is shown in <a class="el" href="#fig5">Fig. 5</a>, whereas we want its initial orientation to be with one face flat on the ground as shown in the appropriate frame of <a class="el" href="#fig1">Fig. 1</a>. This can be fixed by rotating it around its X-axis by one half the <em>dihedral angle</em>, which is the angle between two adjacent faces. The dihedral angle of a regular icosahedron is \(\pi - \arccos(\sqrt{5}/3)\). Therefore the <code>m_qOrientation</code> field of the instance descriptor used to create the icosahedron object in <code><a class="el" href="class_c_game.html#a6a5af1b87c696a23a626812b74c653ea" title="Create game objects.">CGame::CreateObjects</a></code> is <code>DirectX::SimpleMath::Quaternion::CreateFromAxisAngle(Vector3::UnitX, (XM_PI - acosf(sqrtf(5)/3.0f)/2.0f)</code>.</p>
<p><a class="anchor" id="section5-1-4"></a></p><h3>5.1.4 The Teapot</h3>
<p><a class="anchor" id="fig6"></a></p><div class="image">
<img src="teapot.png" alt="" width="40%"/>
<div class="caption">
Fig. 6: The teapot.</div></div>
<p>Amusingly, the geometric primitives provided by DirectX include the teapot (commonly known as the <a href="https://en.wikipedia.org/wiki/Utah_teapot">Utah teapot</a>). Our teapot is shown in <a class="el" href="#fig6">Fig. 6</a>.</p>
<p>The teapot object is an instance of <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code> created in <code><a class="el" href="class_c_object_manager.html#a47c6139224ca0bc1b7aae523e90534c3" title="Create an object.">CObjectManager::Create</a></code>, which takes as a parameter an instance descriptor <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code>. <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code> has useful parameters for the object instance to be created including its orientation <code><a class="el" href="class_c_instance_desc.html#a81f466877c38d26ce68ded644376ac80" title="Orientation.">CInstanceDesc::m_qOrientation</a></code> and scale <code><a class="el" href="class_c_instance_desc.html#a9320b40fceb0fc0fa02669bd234e729d" title="Scale.">CInstanceDesc::m_fScale</a></code>.</p>
<p>The teapot mesh is created in <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> by calling <code>DirectX::GeometricPrimitive::CreateTeapot</code>. <code><a class="el" href="class_c_renderer.html#a0f2f67f2761adb5dac12588ed5962d5f" title="Upload geometric primitive mesh to GPU.">CRenderer::UploadPrimitiveMesh</a></code> is called from <code><a class="el" href="class_c_renderer.html#a38d5e7055814cac465c9a55bf07415ec" title="Load meshes.">CRenderer::LoadGeometricPrimitives</a></code>, which is called from <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code>.</p>
<p><a class="anchor" id="section5-2"></a></p><h2>5.2 Bullet Physics</h2>
<p><a class="anchor" id="section5-2-1"></a></p><h3>5.2.1 Bullet Physics Units</h3>
<p>Bullet Physics has its own scalar <code>btScalar</code>, which will be equivalent to a <code>float</code> if you followed the <a href="../installphysics/index.html#section2">installation instructions</a> carefully. If you left <code>BT_USE_DOUBLE_PRECISION</code> set to <code>true</code>, then <code>btScalar</code> will be a <code>double</code>, which will lead to unnecessary compiler warnings about implicit type casting. It also has a 3D vector <code>btVector3</code> equivalent to <code>DirectX::SimpleMath::Vector3</code>, and a quaternion type <code>btQuaternion</code> equivalent to <code>DirectX::SimpleMath::Quaternion</code>. <span style="background-color:#D8E4D8;"><code><a class="el" href="_game_defines_8h.html" title="Game specific defines.">GameDefines.h</a></code></span> contains the appropriate <code>PW2RW</code> and <code>RW2PW</code> functions to cast and scale to and from physics world and render world, respectively.</p>
<p><a class="anchor" id="section5-2-2"></a></p><h3>5.2.2 Bullet Physics Core Objects</h3>
<p><code><a class="el" href="class_c_common.html" title="The common variables class.">CCommon</a></code> contains a pointer to the Bullet physics world. </p><pre class="fragment">static btDiscreteDynamicsWorld* m_pPhysicsWorld;
</pre><p> It also has pointers to other useful Bullet Physics objects, a <em>default collision configuration</em>, a <em>collision dispatcher</em>, a <em>broad phase interface</em>, and a <em>sequential impulse constraint solver</em>. </p><pre class="fragment">static btDefaultCollisionConfiguration* m_pConfig;
static btCollisionDispatcher* m_pDispatcher;
static btBroadphaseInterface* m_pBroadphase;
static btSequentialImpulseConstraintSolver* m_pSolver;
</pre><p> These common variables are initialized in <code><a class="el" href="class_c_game.html#a59772cac4c768f86382e2f85ad45783f" title="Initialize Bullet Physics engine.">CGame::InitBulletPhysics</a></code>, where the gravity is also set to a hard-coded and somewhat arbitrary value. <code><a class="el" href="class_c_game.html#a59772cac4c768f86382e2f85ad45783f" title="Initialize Bullet Physics engine.">CGame::InitBulletPhysics</a></code> is called by <code><a class="el" href="class_c_game.html#a4349adf43d0dc02d80ad06ca1d77411c" title="Initialize the game.">CGame::Initialize</a></code> which also performs other initialization tasks such as loading primitives and sounds and creating the renderer and the object manager.</p>
<p><a class="anchor" id="section5-2-3"></a></p><h3>5.2.3 Bullet Physics Bodies</h3>
<p>Each object in our 3D world will be represented by an instance of <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code>. The <code><a class="el" href="class_c_object.html" title="The game object.">CObject</a></code> constructor <code><a class="el" href="class_c_object.html#ab56eceb7144e682219eb6462be03b627" title="Constructor.">CObject::CObject</a></code> takes as parameters <code>t</code>, a member of the enumerated type <code>eObject</code> (defined in <span style="background-color:#D8E4D8;"><code><a class="el" href="_game_defines_8h.html" title="Game specific defines.">GameDefines.h</a></code></span>) indicating the object type, and <code>d</code> a <code>const</code> reference to an instance of <code><a class="el" href="class_c_instance_desc.html" title="Instance descriptor.">CInstanceDesc</a></code> filled in with the desired properties of this object instance. It proceeds as follows. A local pointer <code>pShape</code> to an instance of <code>btCollisionShape</code> is declared, then set in a <code>switch</code> statement. If the object is a model, then an instance of <code>btBoxShape</code> for an AABB of the model is used for the shape. If the object is a sphere, then an instance of <code>btSphereShape</code> is used for the shape. If the object is a box or a plane, an instance of <code>btBoxShape</code> is used for the shape. The default, which means that the object is a regular <a class="el" href="#section5-1-1">tetrahedron</a>, <a class="el" href="#section5-1-2">dodecahedron</a>, <a class="el" href="#section5-1-3">icosahedron</a>, or a <a class="el" href="#section5-1-4">teapot</a>, then the convex hull of the object created by <code><a class="el" href="class_c_object.html#a3fe9a61717f053055ef0c33e1882b884" title="Compute convex hull.">CObject::ComputeConvexHull</a></code> is used for the shape. The remainder of the <code><a class="el" href="class_c_object.html#ab56eceb7144e682219eb6462be03b627" title="Constructor.">CObject::CObject</a></code> code creates a physics body for the shape and sets various important attributes. This body is then added to Physics World by calling <code>btDiscreteDynamicsWorld::addRigidBody</code>.</p>
<p><a class="anchor" id="section6"></a></p><h1>6. What Next?</h1>
<p>This 3D toy is pretty rudimentary. Here is a To Do list of things that I need to get around to doing.</p>
<ul>
<li>Add the ability to use a convex hull for collisions on the models. I've gotten it working on the geometric primitives, but that's only because I save a local copy of the vertices. I've tried to access the vertices in a <code>Model</code>, but there seems to be no local copy. I can either override the DirectX function that loads from an <code>sdkmesh</code> or bite the bullet and write an <code>obj</code> file loader (saving a local copy of the vertex buffer in either).</li>
<li>An <code>obj</code> file reader might be a good idea anyway. While you might prefer to shop a game with models in <code>sdkmesh</code> format, it might be better if we could use <code>obj</code>s in class.</li>
<li>Add in the rest of the geometric primitives that DirectXTK12 provides, including cylinders and cones.</li>
<li>Use Bullet joints to make a table out of 4 cylinders and a block with bounding boxes around each part. Have the table come apart after enough hits.</li>
<li>Currently the camera can pass through objects, which is why back-face culling is currently turned off. Use Bullet Physics to prevent this from happening, then turn on back-face culling for a 2x increase in rendering speed.</li>
<li>A lot of the parameters for meshes and models are hard-coded. It would be better to read them from <code>gamesettings.xml</code> along with the other settings instead. Derive a class from <code>Sage::CSettings</code> and write the code for this. </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
