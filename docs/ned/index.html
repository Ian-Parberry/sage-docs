<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ned&#39;s Turkey Farm: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="sagedoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Game.png"/></td>
  <td id="projectalign">
   <div id="projectname">Ned&#39;s Turkey Farm
   </div>
   <div id="projectbrief">A Simple 2.5D Side Scroller</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="contents">
<div class="textblock"><p><a class="anchor" id="sec1"></a></p><h1>1. Introduction</h1>
<p><em>Ned's Turkey Farm</em> is a simple 2.5D side scroller with graphics, particle effects, and sound in which you pilot a plane and kill crows. The plane moves leftwards just to challenge your preconceptions about side scrollers. <a class="el" href="#fig1">Fig. 1</a> shows a screen shot.</p>
<p><a class="anchor" id="fig1"></a></p><div class="image">
<img src="screenshot.png" alt="" width="50%"/>
<div class="caption">
Fig. 1: A screenshot of Ned's Turkey Farm.</div></div>
<p><a class="anchor" id="sec2"></a></p><h1>2. Controls</h1>
<center> <table class="doxtable">
<tr>
<td><center><b>Key</b></center> </td><td><center><b>Action</b></center> </td></tr>
<tr>
<td><center>F1</center> </td><td>Help (this document) </td></tr>
<tr>
<td><center>F2</center> </td><td>Toggle frame rate display </td></tr>
<tr>
<td><center>F3</center> </td><td>Show 3D view </td></tr>
<tr>
<td><center>Up arrow</center> </td><td>Gain height </td></tr>
<tr>
<td><center>Down arrow</center> </td><td>Lose height </td></tr>
<tr>
<td><center>Left arrow</center> </td><td>Move faster (hold down) </td></tr>
<tr>
<td><center>Right arrow</center> </td><td>Move slower (hold down) </td></tr>
<tr>
<td><center>Space</center> </td><td>Shoot </td></tr>
<tr>
<td><center>Backspace</center> </td><td>Restart game </td></tr>
<tr>
<td><center>PrtScr</center> </td><td>Save screenshot to a PNG file </td></tr>
<tr>
<td><center>ESC</center> </td><td>Quit game and close the window </td></tr>
</table>
</center><p><a class="anchor" id="sec3"></a></p><h1>3. SAGE</h1>
<p>This code uses <a href="../sage/index.html">SAGE</a>. Make sure that you have followed the <a href="../install/index.html">SAGE Installation Instructions</a>. Navigate to the folder <span style="background-color:#D8E4D8;"><code>3. Tiled Platformer</code></span> in your copy of the <span style="background-color:#D8E4D8;"><code>sage-games</code></span> repository. Run <span style="background-color:#D8E4D8;"><code>checkenv.bat</code></span> to verify that you have set the environment variables correctly. Open <span style="background-color:#D8E4D8;"><code>Tiled Platformer.sln</code></span> with Visual Studio and build the Release configuration. The Release executable file <span style="background-color:#D8E4D8;"><code>Tiled Platformer.exe</code></span> will appear. Alternatively, run <span style="background-color:#D8E4D8;"><code>Build.bat</code></span> to build both Release and Debug configurations.</p>
<p><a class="anchor" id="sec4"></a></p><h1>4. Game Play</h1>
<p>Run <span style="background-color:#D8E4D8;"><code>Ned's Turkey Farm.exe</code></span> and do the following.</p>
<ol>
<li>
Notice that the background is more 3-dimensional than in previous games. If you play for long enough the background loops. </li>
<li>
Use the controls (see <a class="el" href="#sec2">Section 2</a>) to maneuver the plane up and down. Notice that the camera pivots down when the plane is below its initial height, and moves upwards when the plane is above its initial height. </li>
<li>
Use the controls (see <a class="el" href="#sec2">Section 2</a>) to hunt down the crows and shoot them. Notice that they do a pretty good job of avoiding you. </li>
<li>
Smack the plane into the ground to see smoke particle effects. </li>
<li>
Hit the <code>F3</code> key to cycle through the draw modes so you can see what is really going on in 3D (see <a class="el" href="#fig8">Fig. 8</a>, <a class="el" href="#fig9">Fig. 9</a>, and <a class="el" href="#fig10">Fig. 10</a>.). </li>
</ol>
<p><a class="anchor" id="fig2"></a></p><div class="image">
<img src="planesmoke.png" alt="" width="30%"/>
<div class="caption">
Fig. 2: Smoke from a damaged plane.</div></div>
<p><a class="anchor" id="sec5"></a></p><h1>5. Code Breakdown</h1>
<p>Open <span style="background-color:#D8E4D8;"><code>Ned's Turkey Farm.sln</code></span> in Visual Studio and examine the code in the editor while you read the rest of this section. This section assumes that you have read and understood the documentation from <a href="../sage/index.html">SAGE</a>, <a href="../blank/index.html">The Blank Game</a>, <a href="../topdown/index.html">The Top Down Game</a>, <a href="../topdowntiled/index.html">The Top Down Tiled Game</a> and <a href="../platformer/index.html">The Tiled Platformer</a>. How does this code differ from those games? Most importantly, we must now deal with the third spatial dimension (<a class="el" href="#sec5-1">Section 5.1),</a>which means that we must depth-sort our sprites (<a class="el" href="#sec5-2">Section 5.2),</a>and make a 3D background which we will wrap at the edges to make an infinite repeating game world (<a class="el" href="#sec5-3">Section 5.3).</a> <a class="anchor" id="sec5-1"></a></p><h2>5.1 The Third Dimension</h2>
<p><em>Ned's Turkey Farm</em> is a 2.5D game, which means that it is a 3D game with 2D sprite art. It has its own renderer class <code><a class="el" href="class_c_renderer.html" title="The game renderer.">CRenderer</a></code> which is derived from <code>Sage::CSpriteRenderer</code> and is instantiated with </p><pre class="fragment">Sage::CSpriteRenderer(Sage::eSpriteMode::Unbatched3D)
</pre><p>whereas previous <a href="../sage/index.html">SAGE</a> games (<a href="../blank/index.html">The Blank Game</a>, <a href="../topdown/index.html">The Top Down Game</a>, <a href="../topdowntiled/index.html">The Top Down Tiled Game</a> and <a href="../platformer/index.html">The Tiled Platformer</a>) used </p><pre class="fragment">Sage::CSpriteRenderer(Sage::eSpriteMode::Batched2D)
</pre><p>Sprite descriptors are now 3D, that is, <a href="../sage/class_sage_1_1_c_sprite_desc3_d.html"><code>Sage::CSpriteDesc3D</code></a> is used instead of <a href="../sage/class_sage_1_1_c_sprite_desc2_d.html"><code>Sage::CSpriteDesc2D</code></a>. While <code>Sage::CSpriteDesc2D::m_vPos</code> is a 2D vector <code>Vector2</code>, <code>Sage::CSpriteDesc3D::m_vPos</code> is a 3D vector <code>Vector3</code>, which has a third coordinate for the Z axis. The Z axis is at right angles to both the X and Y axes, but there are two directions to choose from. If the X axis is along the bottom of your screen with positive X to the right and the Y axis is along the side of your screen with positive Y upwards, then there are two choices for the positive Z axis. It can either point into the screen or out of the screen. Either choice is as good as the other but you <em>must make sure that all of your code is consistent with this choice</em>.</p>
<p><a href="../sage/index.html">SAGE</a> uses what is called a <em>left-handed coordinate system</em>. Take your left hand and make your thumb point towards positive X, your index finger to positive Y, and put your third finger at right angles to them. Then your third finger points in the direction of positive Z, into the screen as shown in <a class="el" href="#fig3">Fig. 3</a>. Similarly, using your right hand points your third finger in the opposite direction, out of the screen, in what is called a <em>right-handed coordinate system</em>.</p>
<p><a class="anchor" id="fig3"></a></p><div class="image">
<img src="axes.png" alt="" width="30%"/>
<div class="caption">
Fig. 3: The principal axes in left-handed coordinate space.</div></div>
<p><a href="../sage/class_sage_1_1_c_sprite_desc2_d.html"><code>Sage::CSpriteDesc2D</code></a> has one rotation angle <code>Sage::CSpriteDesc2D::m_fRoll</code> which makes sense because there is only axis to rotate about, which we now know as the Z axis. In 3D there are now three principal axes about which to rotate. Rotation about the X axis is called <em>pitch</em> and is stored in <code>Sage::CSpriteDesc3D::m_fPitch</code>, and rotation about the Y axis is called <em>yaw</em> and is stored in <code>Sage::CSpriteDesc3D::m_fYaw</code>.</p>
<p>Recall that in 2D we chose positive angles of rotation to be counterclockwise. There is a useful convention for this based on handedness. In a left-handed coordinate system take your left hand, make a fist with your thumb sticking out and pointing along the positive Z axis. Look at your curled fingers from the negative Z side. The direction that they curl is a positive angle of rotation along the Z axis. Your can see from <a class="el" href="#fig4">Fig. 4</a> that this is a counterclockwise direction, which is consistent with our 2D games. You can find the direction of positive rotation about any axis by pointing your thumb in the positive direction and viewing the curl of your fingers from the negative side of the axis.</p>
<p><a class="anchor" id="fig4"></a></p><div class="image">
<img src="roll.png" alt="" width="30%"/>
<div class="caption">
Fig. 4: Positive roll in left-handed coordinate space is counterclockwise.</div></div>
<p><a class="anchor" id="sec5-2"></a></p><h2>5.2 Depth Sorting</h2>
<p>As mentioned in <a class="el" href="#sec5-1">Section 5.1</a>, previous <a href="../sage/index.html">SAGE</a> games (<a href="../blank/index.html">The Blank Game</a>, <a href="../topdown/index.html">The Top Down Game</a>, <a href="../topdowntiled/index.html">The Top Down Tiled Game</a> and <a href="../platformer/index.html">The Tiled Platformer</a>) use </p><pre class="fragment">Sage::CSpriteRenderer(Sage::eSpriteMode::Batched2D)
</pre><p>which draws sprites from back to front in the order that their <code>Draw</code> function is called. In this game we want explicit control of the Z axis, which we get by deriving <code><a class="el" href="class_c_renderer.html" title="The game renderer.">CRenderer</a></code> from </p><pre class="fragment">Sage::CSpriteRenderer(Sage::eSpriteMode::Unbatched3D)
</pre><p>instead. Now sprites must be draw in descending order of their Z coordinate, which <a href="../sage/index.html">SAGE</a> will do for you if you collect your sprite descriptors into an instance of <code>std::vector&lt;Sage::CSpriteDesc3D&gt;</code> and pass this as a parameter to <code>Sage::CSpriteRenderer::Draw</code> which will sort them by depth (in Z-order) before rendering them. See <a href="../sage/index.html#sec3-5">the SAGE renderer documentation</a> for more details.</p>
<p>What can go wrong if you don't take advantage of <a href="../sage/index.html"><code>Sage</code></a>'s functionality to sort the sprites in this game into descending Z order? <a href="../sage/index.html"><code>Sage</code></a> uses a <a href="https://en.wikipedia.org/wiki/Z-buffering">Z-buffer</a> to speed up rendering. Unfortunately, Z-buffers count the transparent pixels of the game as having the same depth as non-transparent ones, and therefore refuse to draw the pixels behind a transparent one. This can lead to sprites disappearing behind the transparent pixels of a sprite that was drawn earlier, as in the following examples.</p>
<p><a class="anchor" id="fig5"></a></p><div class="image">
<img src="nodepthsort.png" alt="" width="60%"/>
<div class="caption">
Fig. 5: Errors in depth sorting.</div></div>
<p>In <a class="el" href="#fig11">Fig. 5</a> (left), the crow's Z coordinate is behind the plane's Z coordinate but the plane is drawn first, resulting in the transparent pixels of the plane sprite canceling out the crow's body (see the yellow arrow) leaving just its head sticking out to the left of the plane. In <a class="el" href="#fig1">Fig. 5</a> (right), the crow's Z coordinate is in front of the plane's Z coordinate but the crow is drawn first, resulting in the transparent pixels of the crow sprite canceling out the part of the plane's tail (see the yellow arrow).</p>
<p><a class="anchor" id="sec5-3"></a></p><h2>5.3 The Background</h2>
<p>The background for <em>Ned's Turkey Farm</em> consists of a sky image (<a class="el" href="#fig6">Fig. 6</a>, left) that can be repeated horizontally without the join showing (<a class="el" href="#fig6">Fig. 6</a>, right), and a ground image (<a class="el" href="#fig7">Fig. 7</a>, left) that can be repeated horizontally without the join showing (<a class="el" href="#fig7">Fig. 7</a>, right).</p>
<p><a class="anchor" id="fig6"></a></p><div class="image">
<img src="sky.png" alt="" width="60%"/>
<div class="caption">
Fig. 6: The sky sprite (left) can be tiled (right).</div></div>
<p><a class="anchor" id="fig7"></a></p><div class="image">
<img src="ground.png" alt="" width="60%"/>
<div class="caption">
Fig. 7: The ground sprite (left) can be tiled (right).</div></div>
<p>The sky and ground images are put together in an L shape as shown in <a class="el" href="#fig7">Fig. 8</a>. This is referred to in the code as a <em>cell</em>. The sky part of the cell is in the XY plane, that is, at right angles to the Z axis. This is the default for sprites when yaw and pitch are set to zero. The ground part of the cell is in the XZ plane, that is, at right angles to the Y axis. We will achieve this by setting its pitch to \(\pi/2\).</p>
<p><a class="anchor" id="fig8"></a></p><div class="image">
<img src="cell.png" alt="" width="60%"/>
<div class="caption">
Fig. 8: A single cell in 3D.</div></div>
<p>The background cells are drawn by <code><a class="el" href="class_c_object_manager.html#afb9135b4070eaf38d73c70655959b678" title="Draw background.">CObjectManager::DrawBackground</a></code> using <code><a class="el" href="class_c_object_manager.html#a0cbcca158cfe3d1c0b2630e9e3b0bbee" title="Sky descriptor.">CObjectManager::m_cSkyDesc</a></code> for the sky 3D sprite descriptor and <code><a class="el" href="class_c_object_manager.html#a43b41ac2ae39673cbe80a9863679b887" title="Ground descriptor.">CObjectManager::m_cGrndDesc</a></code> for the ground 3D sprite descriptor. Notice that <code>CObjectManager::m_cGrndDesc.m_fPitch</code> is set to \(\pi/2\) in <code><a class="el" href="class_c_object_manager.html#a5f13656ff4050c227c8f1fb27803d116" title="Clear.">CObjectManager::Clear</a></code>. The number of cells drawn is <code><a class="el" href="class_c_common.html#aa88fc455a71f87dde8d753c661cc3998" title="Number of cells.">CCommon::m_nNumCells</a></code> for the game play area plus an extra cell to the left and right for when the camera is near the leftmost and rightmost edge of the play area, respectively. <code><a class="el" href="class_c_common.html#aa88fc455a71f87dde8d753c661cc3998" title="Number of cells.">CCommon::m_nNumCells</a></code> is set to three, so the game world consists of those three cells plus an extra cell at each end for when the view frustum is at the edge of a cell. This is shown in <a class="el" href="#fig9">Fig. 9</a>, which you can see by hitting the <code>F3</code> key (see <a class="el" href="#sec2">Section 2</a> for more keyboard controls).</p>
<p><a class="anchor" id="fig9"></a></p><div class="image">
<img src="f3.png" alt="" width="90%"/>
<div class="caption">
Fig. 9: The 3D game world consists of five cells.</div></div>
<p>The player is totally oblivious to this and sees a small portion of this world as shown in <a class="el" href="#fig1">Fig. 1</a>. They see the contents of the camera's <a href="https://en.wikipedia.org/wiki/Viewing_frustum"><em>view frustum</em></a>, the back face of which is drawn as a back rectangle in <a class="el" href="#fig10">Fig. 10</a> and <a class="el" href="#fig11">Fig. 11</a>. <a class="el" href="#fig10">Fig. 10</a> shows the plane in its initial position to the right of the game world with the view frustum allowing a view of the background approximately inside the black rectangle. Lines are also drawn on the sky background so that you can see the boundaries between cells more clearly. You can see how the view frustum moves with the plane by hitting the <code>F3</code> key a second time. (To return to the player view as shown in <a class="el" href="#fig1">Fig. 1</a>, hit the <code>F3</code> key a third time.)</p>
<p><a class="anchor" id="fig10"></a></p><div class="image">
<img src="initial.png" alt="" width="90%"/>
<div class="caption">
Fig. 10: The 3D game world showing the back of the view frustum when the plane is in the initial position.</div></div>
<p><a class="el" href="#fig11">Fig. 11</a> shows the plane in its leftmost position one frame before being wrapped around to the right of of world to its initial position. The trick here is making the objects inside the view frustum before wrapping around (<a class="el" href="#fig11">Fig. 11</a>) also appear in the next frame in which the plane wraps around to the right (<a class="el" href="#fig10">Fig. 10</a>). This is done by drawing a second copy of those objects in <code><a class="el" href="class_c_object_manager.html#ac59fc2d0815fc9f56c5ef2c74db4d487" title="Get render list.">CObjectManager::GetRenderList</a></code>, which as already mentioned, will lead to a second plane being drawn out of frustum.</p>
<p><a class="anchor" id="fig11"></a></p><div class="image">
<img src="prewrap.png" alt="" width="90%"/>
<div class="caption">
Fig. 11: The 3D game world showing the back of the view frustum when the plane is about to wrap from left to right.</div></div>
<p><a class="anchor" id="sec6"></a></p><h1>6. What Next?</h1>
<p>You might want to look at <a href="../introphysics/index.html">Physics Games and Toys</a> next. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
